# ç”µå½±ç¥¨åŠ¡ç®¡ç†ç³»ç»Ÿ - Docker éƒ¨ç½²

è¿™æ˜¯ä¸€ä¸ªåŸºäº Spring Boot + Vue 3 çš„å…¨æ ˆç”µå½±ç¥¨åŠ¡ç®¡ç†ç³»ç»Ÿçš„ Docker éƒ¨ç½²æ–¹æ¡ˆã€‚

## ğŸ¯ ç‰¹ç‚¹

- âœ… **ç‹¬ç«‹éƒ¨ç½²**: ä½¿ç”¨ç‹¬ç«‹çš„å®¹å™¨åç§°ã€ç½‘ç»œå’Œå·,ä¸å½±å“æœåŠ¡å™¨ä¸Šçš„å…¶ä»– Docker é¡¹ç›®
- âœ… **ç«¯å£çµæ´»**: å‰ç«¯ä½¿ç”¨ 8081 ç«¯å£,é¿å…ä¸å¸¸è§çš„ 80/8080 ç«¯å£å†²çª
- âœ… **è¿æ¥å®¿ä¸»æœºæœåŠ¡**: æ”¯æŒè¿æ¥å®¿ä¸»æœºä¸Šçš„ MySQL å’Œ Redis
- âœ… **ä¸€é”®éƒ¨ç½²**: æä¾›è‡ªåŠ¨åŒ–éƒ¨ç½²è„šæœ¬
- âœ… **å¥åº·æ£€æŸ¥**: è‡ªåŠ¨æ£€æµ‹æœåŠ¡çŠ¶æ€
- âœ… **æ•°æ®æŒä¹…åŒ–**: æ–‡ä»¶ä¸Šä¼ å’Œæ—¥å¿—æŒä¹…åŒ–å­˜å‚¨

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
xm_film_ticket/
â”œâ”€â”€ springboot/              # åç«¯ä»£ç 
â”‚   â”œâ”€â”€ Dockerfile          # åç«¯å®¹å™¨é…ç½®
â”‚   â””â”€â”€ src/
â”‚       â””â”€â”€ main/resources/
â”‚           â””â”€â”€ application-docker.yml  # Docker ç¯å¢ƒé…ç½®
â”œâ”€â”€ vue/                    # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ Dockerfile         # å‰ç«¯å®¹å™¨é…ç½®
â”‚   â””â”€â”€ nginx.conf         # Nginx é…ç½®
â”œâ”€â”€ docker-compose.yml     # å®¹å™¨ç¼–æ’é…ç½®
â”œâ”€â”€ .env.example          # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ build.sh              # æ„å»ºè„šæœ¬
â”œâ”€â”€ deploy.sh             # éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ stop.sh               # åœæ­¢è„šæœ¬
â”œâ”€â”€ QUICKSTART.md         # å¿«é€Ÿå¼€å§‹æŒ‡å—
â””â”€â”€ DEPLOYMENT.md         # è¯¦ç»†éƒ¨ç½²æ–‡æ¡£
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®ç¯å¢ƒå˜é‡

```bash
cp .env.example .env
nano .env  # å¡«å…¥ MySQL å’Œ Redis å¯†ç 
```

### 2. ä¿®å¤è„šæœ¬è¡Œå°¾ç¬¦ï¼ˆé‡è¦ï¼ï¼‰

**å¦‚æœæ‚¨åœ¨ Windows ä¸Šå¼€å‘ï¼Œéœ€è¦å…ˆä¿®å¤è„šæœ¬çš„è¡Œå°¾ç¬¦**ï¼š

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
sudo apt-get install -y dos2unix
dos2unix *.sh
```

æˆ–è€…ä½¿ç”¨ sedï¼š

```bash
sed -i 's/\r$//' *.sh
```

è¯¦ç»†è¯´æ˜è¯·æŸ¥çœ‹: [FIX_LINE_ENDINGS.md](FIX_LINE_ENDINGS.md)

### 3. ç»™è„šæœ¬æ·»åŠ æ‰§è¡Œæƒé™

```bash
chmod +x build.sh deploy.sh stop.sh
```

### 4. éƒ¨ç½²

```bash
./deploy.sh
```

### 5. è®¿é—®åº”ç”¨

- å‰ç«¯: http://your-server-ip:8081
- åç«¯: http://your-server-ip:9090

## ğŸ“‹ éƒ¨ç½²ä¿¡æ¯

### ç«¯å£é…ç½®

| æœåŠ¡ | å®¹å™¨ç«¯å£ | å®¿ä¸»æœºç«¯å£ | è¯´æ˜ |
|------|---------|-----------|------|
| å‰ç«¯ | 80 | 8081 | é¿å…ä¸å…¶ä»–é¡¹ç›®å†²çª |
| åç«¯ | 9090 | 9090 | Spring Boot API |

### å®¹å™¨ä¿¡æ¯

| å®¹å™¨åç§° | é•œåƒ | è¯´æ˜ |
|---------|------|------|
| xm_film_ticket_frontend | xm-film-frontend:latest | Vue 3 + Nginx |
| xm_film_ticket_backend | xm-film-backend:latest | Spring Boot 3.3.1 |

### Docker èµ„æº

- **ç½‘ç»œ**: `xm_film_network` (ç‹¬ç«‹ç½‘ç»œ)
- **å·**:
  - `xm_film_upload_files` (æ–‡ä»¶ä¸Šä¼ )
  - `xm_film_backend_logs` (åç«¯æ—¥å¿—)

## ğŸ”§ å¸¸ç”¨å‘½ä»¤

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢æœåŠ¡
./stop.sh

# æ›´æ–°ä»£ç 
git pull && ./deploy.sh
```

## ğŸ“š æ–‡æ¡£

- [å¿«é€Ÿå¼€å§‹æŒ‡å—](QUICKSTART.md) - å¿«é€Ÿéƒ¨ç½²å‚è€ƒ
- [è¯¦ç»†éƒ¨ç½²æ–‡æ¡£](DEPLOYMENT.md) - å®Œæ•´çš„éƒ¨ç½²æ­¥éª¤å’Œæ•…éšœæ’æŸ¥

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç«¯å£å†²çª**: å¦‚æœ 8081 æˆ– 9090 ç«¯å£è¢«å ç”¨,è¯·ä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç«¯å£æ˜ å°„
2. **MySQL é…ç½®**: ç¡®ä¿ MySQL çš„ `bind-address = 0.0.0.0`
3. **Redis é…ç½®**: ç¡®ä¿ Redis çš„ `bind 0.0.0.0`
4. **ç¯å¢ƒå˜é‡**: å¿…é¡»åˆ›å»º `.env` æ–‡ä»¶å¹¶å¡«å…¥å®é™…å¯†ç 

## ğŸ” ä¸å…¶ä»–é¡¹ç›®å…±å­˜

æœ¬é¡¹ç›®ä½¿ç”¨ç‹¬ç«‹çš„å‘½åç©ºé—´,å¯ä»¥ä¸æœåŠ¡å™¨ä¸Šçš„å…¶ä»– Docker é¡¹ç›®å’Œå¹³å…±å­˜:

- ç‹¬ç«‹çš„å®¹å™¨åç§° (`xm_film_ticket_*`)
- ç‹¬ç«‹çš„ç½‘ç»œ (`xm_film_network`)
- ç‹¬ç«‹çš„å· (`xm_film_*`)
- å¯é…ç½®çš„ç«¯å£æ˜ å°„

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

### ç«¯å£è¢«å ç”¨

```bash
# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep -E '8081|9090'

# ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£
```

### åç«¯æ— æ³•è¿æ¥æ•°æ®åº“

```bash
# æ£€æŸ¥ MySQL é…ç½®
sudo nano /etc/mysql/mysql.conf.d/mysqld.cnf
# ç¡®ä¿: bind-address = 0.0.0.0

# é‡å¯ MySQL
sudo systemctl restart mysql
```

### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

```bash
# åç«¯æ—¥å¿—
docker-compose logs backend

# å‰ç«¯æ—¥å¿—
docker-compose logs frontend
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜,è¯·æŸ¥çœ‹:
1. [QUICKSTART.md](QUICKSTART.md) - å¿«é€Ÿå‚è€ƒ
2. [DEPLOYMENT.md](DEPLOYMENT.md) - è¯¦ç»†æ–‡æ¡£
3. å®¹å™¨æ—¥å¿—: `docker-compose logs -f`

---

**ç¥éƒ¨ç½²é¡ºåˆ©! ğŸ‰**
