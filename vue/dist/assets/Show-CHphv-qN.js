import{v as Z,r as ee,c as y,a as I,i as m,j as d,b as o,w as r,E as i,J as E,K as le,ah as te,B as ae,L as oe,M as re,N as se,O as ne,o as n,h as c,t as D,u as M,P as ie,Q as me,F as w,z as x,I as de,R as ue,S as pe,G as fe,T as ce,ai as ge,aj as _e,aa as be,V as ye}from"./index-DNfxLx3V.js";/* empty css               *//* empty css                *//* empty css                  *//* empty css                    *//* empty css                     *//* empty css              *//* empty css                     *//* empty css                   *//* empty css            *//* empty css               *//* empty css                  *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                *//* empty css                     *//* empty css               *//* empty css                    */import{r as g}from"./request-B9NmRS_H.js";/* empty css                    */const Ve={class:"card",style:{"margin-bottom":"5px"}},Ie={class:"card",style:{"margin-bottom":"5px"}},Ne={class:"card",style:{"margin-bottom":"5px"}},he={key:0,class:"card"},De={key:0,style:{color:"#ff4949","margin-left":"10px"}},we={class:"dialog-footer"},He={__name:"Show",setup(xe){const k=Z(),e=ee({user:JSON.parse(localStorage.getItem("xm-user")||"{}"),formVisible:!1,form:{},tableData:[],pageNum:1,pageSize:8,total:0,name:null,cinemaName:null,filmName:null,time:null,status:null,ids:[],roomData:[],filmData:[],cinemaData:[],rules:{roomId:[{required:!0,message:"请选择影厅房间",trigger:"change"}],filmId:[{required:!0,message:"请选择放映电影",trigger:"change"}],time:[{required:!0,message:"请选择放映时间",trigger:"change"}],price:[{required:!0,message:"请输入电影票价",trigger:"blur"}],status:[{required:!0,message:"请选择放映状态",trigger:"change"}],cinemaId:[{required:!0,message:"请选择所属影院",trigger:"change"}]}}),A=()=>{e.user.role==="ADMIN"&&g.get("/cinema/selectAll").then(a=>{a.code==="200"?e.cinemaData=a.data:i.error(a.msg)})},S=a=>{a?(N(a),e.form.roomId=null):e.roomData=[]},N=a=>{if(!a&&e.user.role==="ADMIN"){e.roomData=[];return}const l=a||(e.user.role==="CINEMA"?e.user.id:null);if(!l){e.roomData=[];return}g.get("/room/selectAll",{params:{cinemaId:l}}).then(s=>{s.code==="200"?(e.roomData=s.data,e.form.roomId&&(e.roomData.some(_=>_.id===e.form.roomId)||(e.form.roomId=null))):(i.error(s.msg),e.roomData=[])}).catch(()=>{e.roomData=[]})},U=()=>{g.get("/film/selectAll").then(a=>{a.code==="200"?e.filmData=a.data:i.error(a.msg)})},p=()=>{g.get("/show/selectPage",{params:{pageNum:e.pageNum,pageSize:e.pageSize,name:e.name,cinemaName:e.cinemaName,filmName:e.filmName,time:e.time,status:e.status}}).then(a=>{var l,s;a.code==="200"?(e.tableData=((l=a.data)==null?void 0:l.list)||[],e.total=(s=a.data)==null?void 0:s.total):i.error(a.msg)})},B=()=>{e.form={},e.form.status="购票中",e.user.role==="CINEMA"?(e.form.cinemaId=e.user.id,N(e.user.id)):e.user.role==="ADMIN"&&(e.roomData=[]),e.formVisible=!0},q=a=>{e.form=JSON.parse(JSON.stringify(a)),e.user.role==="ADMIN"?N(e.form.cinemaId):e.user.role==="CINEMA"&&N(e.user.id),e.formVisible=!0},F=()=>{g.post("/show/add",e.form).then(a=>{a.code==="200"?(i.success("操作成功"),e.formVisible=!1,p()):i.error(a.msg)})},Y=()=>{g.put("/show/update",e.form).then(a=>{a.code==="200"&&(i.success("操作成功"),e.formVisible=!1,p())})},z=()=>{k.value.validate(a=>{if(a){const l=e.form.filmId,s=e.filmData.find(V=>V.id===l);if(s&&s.status!=="已上映"){i.error(`《${s.title}》${s.status}，无法添加放映记录`);return}e.form.id?Y():F()}})},$=a=>{E.confirm("删除后数据无法恢复，您确定删除吗？","删除确认",{type:"warning"}).then(l=>{g.delete("/show/delete/"+a).then(s=>{s.code==="200"?(i.success("删除成功"),p()):i.error(s.msg)})}).catch(l=>{console.error(l)})},R=()=>{if(!e.ids.length){i.warning("请选择数据");return}E.confirm("删除后数据无法恢复，您确定删除吗？","删除确认",{type:"warning"}).then(a=>{g.delete("/show/delete/batch",{data:e.ids}).then(l=>{l.code==="200"?(i.success("操作成功"),p()):i.error(l.msg)})}).catch(a=>{console.error(a)})},O=a=>{e.ids=a.map(l=>l.id)},P=()=>{e.name=null,e.cinemaName=null,e.filmName=null,e.time=null,e.status=null,p()},T=a=>{console.log(a)},J=a=>{const l=e.filmData.find(s=>s.id===a);l&&l.status!=="已上映"&&(i.warning(`《${l.title}》${l.status}，无法添加放映记录`),e.form.filmId=null)};return A(),U(),p(),(a,l)=>{const s=le,V=te,_=de,h=ae,f=oe,u=ue,j=pe,C=fe,G=re,H=se,b=ce,L=ge,v=_e,K=be,Q=ye,W=ne;return n(),y("div",null,[I("div",Ve,[e.user.role==="ADMIN"?(n(),m(s,{key:0,modelValue:e.cinemaName,"onUpdate:modelValue":l[0]||(l[0]=t=>e.cinemaName=t),"prefix-icon":"Search",style:{width:"240px","margin-right":"10px"},placeholder:"请输入影院名称查询"},null,8,["modelValue"])):d("",!0),o(s,{modelValue:e.filmName,"onUpdate:modelValue":l[1]||(l[1]=t=>e.filmName=t),"prefix-icon":"Search",style:{width:"240px","margin-right":"10px"},placeholder:"请输入电影名称查询"},null,8,["modelValue"]),o(V,{style:{width:"240px","margin-right":"10px"},modelValue:e.time,"onUpdate:modelValue":l[2]||(l[2]=t=>e.time=t),type:"date",placeholder:"请选择日期","value-format":"YYYY-MM-DD"},null,8,["modelValue"]),o(h,{modelValue:e.status,"onUpdate:modelValue":l[3]||(l[3]=t=>e.status=t),placeholder:"请选择放映状态",style:{width:"240px","margin-right":"10px"}},{default:r(()=>[o(_,{label:"购票中",value:"购票中"}),o(_,{label:"已放映",value:"已放映"})]),_:1},8,["modelValue"]),o(f,{type:"info",plain:"",onClick:p},{default:r(()=>l[13]||(l[13]=[c("查询")])),_:1}),o(f,{type:"warning",plain:"",style:{margin:"0 10px"},onClick:P},{default:r(()=>l[14]||(l[14]=[c("重置")])),_:1})]),I("div",Ie,[e.user.role==="CINEMA"||e.user.role==="ADMIN"?(n(),m(f,{key:0,type:"primary",plain:"",onClick:B},{default:r(()=>l[15]||(l[15]=[c("新增")])),_:1})):d("",!0),o(f,{type:"danger",plain:"",onClick:R},{default:r(()=>l[16]||(l[16]=[c("批量删除")])),_:1})]),I("div",Ne,[o(G,{stripe:"",data:e.tableData,onSelectionChange:O},{default:r(()=>[o(u,{type:"selection",width:"55"}),o(u,{prop:"filmImg",label:"电影封面"},{default:r(t=>[t.row.filmImg?(n(),m(j,{key:0,style:{width:"40px",height:"40px","border-radius":"5px",display:"block"},src:t.row.filmImg,"preview-src-list":[t.row.filmImg],"preview-teleported":""},null,8,["src","preview-src-list"])):d("",!0)]),_:1}),o(u,{prop:"filmName",label:"电影名称"}),e.user.role==="ADMIN"?(n(),m(u,{key:0,prop:"cinemaName",label:"影院名称"})):d("",!0),o(u,{prop:"roomName",label:"影厅名称"}),o(u,{prop:"price",label:"电影票价/元"}),o(u,{prop:"time",label:"放映时间"}),o(u,{prop:"status",label:"放映状态"},{default:r(t=>[t.row.status==="购票中"?(n(),m(C,{key:0,type:"success"},{default:r(()=>[c(D(t.row.status),1)]),_:2},1024)):d("",!0),t.row.status==="已放映"?(n(),m(C,{key:1,type:"danger"},{default:r(()=>[c(D(t.row.status),1)]),_:2},1024)):d("",!0)]),_:1}),o(u,{label:"操作",width:"100",fixed:"right"},{default:r(t=>[e.user.role==="CINEMA"||e.user.role==="ADMIN"?(n(),m(f,{key:0,type:"primary",circle:"",icon:M(ie),onClick:X=>q(t.row)},null,8,["icon","onClick"])):d("",!0),o(f,{type:"danger",circle:"",icon:M(me),onClick:X=>$(t.row.id)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])]),e.total?(n(),y("div",he,[o(H,{onCurrentChange:p,background:"",layout:"prev, pager, next","page-size":e.pageSize,"current-page":e.pageNum,"onUpdate:currentPage":l[4]||(l[4]=t=>e.pageNum=t),total:e.total},null,8,["page-size","current-page","total"])])):d("",!0),o(W,{title:"电影放映信息",modelValue:e.formVisible,"onUpdate:modelValue":l[12]||(l[12]=t=>e.formVisible=t),width:"40%","destroy-on-close":""},{footer:r(()=>[I("span",we,[o(f,{onClick:l[11]||(l[11]=t=>e.formVisible=!1)},{default:r(()=>l[17]||(l[17]=[c("取 消")])),_:1}),o(f,{type:"primary",onClick:z},{default:r(()=>l[18]||(l[18]=[c("确 定")])),_:1})])]),default:r(()=>[o(Q,{ref_key:"formRef",ref:k,rules:e.rules,model:e.form,"label-width":"80px",style:{padding:"20px"}},{default:r(()=>[e.user.role==="ADMIN"?(n(),m(b,{key:0,prop:"cinemaId",label:"所属影院"},{default:r(()=>[o(h,{modelValue:e.form.cinemaId,"onUpdate:modelValue":l[5]||(l[5]=t=>e.form.cinemaId=t),placeholder:"请选择所属影院",onChange:S},{default:r(()=>[(n(!0),y(w,null,x(e.cinemaData,t=>(n(),m(_,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):d("",!0),o(b,{prop:"roomId",label:"影厅房间"},{default:r(()=>[o(h,{modelValue:e.form.roomId,"onUpdate:modelValue":l[6]||(l[6]=t=>e.form.roomId=t),placeholder:"请选择影厅房间"},{default:r(()=>[(n(!0),y(w,null,x(e.roomData,t=>(n(),m(_,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(b,{prop:"filmId",label:"放映电影"},{default:r(()=>[o(h,{modelValue:e.form.filmId,"onUpdate:modelValue":l[7]||(l[7]=t=>e.form.filmId=t),placeholder:"请选择放映电影",onChange:J},{default:r(()=>[(n(!0),y(w,null,x(e.filmData,t=>(n(),m(_,{key:t.id,label:t.title,value:t.id,disabled:t.status!=="已上映"},{default:r(()=>[I("span",null,D(t.title),1),t.status!=="已上映"?(n(),y("span",De,"("+D(t.status)+")",1)):d("",!0)]),_:2},1032,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(b,{prop:"time",label:"放映时间"},{default:r(()=>[o(V,{style:{width:"200px"},modelValue:e.form.time,"onUpdate:modelValue":l[8]||(l[8]=t=>e.form.time=t),type:"datetime",placeholder:"请选择日期","value-format":"YYYY-MM-DD HH:mm:ss"},null,8,["modelValue"])]),_:1}),o(b,{prop:"price",label:"电影票价"},{default:r(()=>[o(L,{style:{width:"200px"},modelValue:e.form.price,"onUpdate:modelValue":l[9]||(l[9]=t=>e.form.price=t),min:1,step:.1,precision:2,onChange:T},null,8,["modelValue"])]),_:1}),o(b,{prop:"status",label:"放映状态"},{default:r(()=>[o(K,{modelValue:e.form.status,"onUpdate:modelValue":l[10]||(l[10]=t=>e.form.status=t)},{default:r(()=>[o(v,{label:"购票中",value:"购票中"}),o(v,{label:"已放映",value:"已放映"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["rules","model"])]),_:1},8,["modelValue"])])}}};export{He as default};
