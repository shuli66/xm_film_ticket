import{_ as N,v as g,y as q,E as d,r as L,c as w,b as o,a,w as s,C as F,V as M,O as z,o as _,u as m,aK as B,aL as V,h as u,ay as A,d as v,K as T,T as $,I as D,B as O,L as K,aM as j,m as H}from"./index-CwlnEuFy.js";/* empty css               *//* empty css                *//* empty css                  *//* empty css             *//* empty css               *//* empty css            *//* empty css               *//* empty css                  *//* empty css               *//* empty css              */import{r as x}from"./request--KQcSzqU.js";import{S as J}from"./SnowEffect-DW9vsaST.js";const W={class:"login-wrapper"},G={key:0},Q={key:1,class:"loading-spinner"},X={class:"login-actions fade-in"},Y={class:"dialog-footer"},Z={__name:"Login",setup(ee){const b=g(),y=g(),P=g(!1);q(()=>{setTimeout(()=>{P.value=!0},300);const n=new URLSearchParams(window.location.search);if((n.get("auth_error")==="true"||n.get("expired")==="true")&&(localStorage.removeItem("xm-user"),d.error("您的登录已过期，请重新登录")),window.location.pathname.endsWith("/login")&&(localStorage.removeItem("xm-user"),window.location.search)){const l=window.location.pathname;window.history.replaceState({},document.title,l)}});const r=L({form:{},forgetForm:{phone:"",newPassword:"",confirmPassword:""},forgetVisible:!1,loading:!1,rules:{username:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"blur"}]}}),k={phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(n,e,l)=>{e!==r.forgetForm.newPassword?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]},I=()=>{b.value.validate(n=>{n&&(r.loading=!0,x.post("/login",r.form).then(e=>{e.code==="200"?(d.success("登录成功"),localStorage.setItem("xm-user",JSON.stringify(e.data)),sessionStorage.setItem("just_logged_in","true"),setTimeout(()=>{e.data.role==="USER"&&v.push("/front/home"),e.data.role==="CINEMA"&&v.push("/manager/home"),e.data.role==="ADMIN"&&v.push("/manager/adminHome")},800)):(d.error(e.msg),r.loading=!1)}).catch(()=>{r.loading=!1}))})},S=()=>{r.forgetVisible=!0,r.forgetForm={phone:"",newPassword:"",confirmPassword:""}},C=()=>{y.value.validate(n=>{n&&x.post("/user/resetPassword",r.forgetForm).then(e=>{e.code==="200"?(d({type:"success",message:"密码重置成功，请使用新密码登录",duration:3e3}),r.forgetVisible=!1,r.forgetForm={phone:"",newPassword:"",confirmPassword:""}):d({type:"error",message:e.msg||"密码重置失败",duration:3e3})}).catch(e=>{d({type:"error",message:"系统错误，请稍后重试",duration:3e3})})})};return(n,e)=>{const l=T,i=$,p=D,U=O,f=K,h=j,E=M,c=H,R=z;return _(),w("div",W,[o(J),e[14]||(e[14]=a("div",{class:"floating-circles"},[a("div",{class:"circle circle-1"}),a("div",{class:"circle circle-2"}),a("div",{class:"circle circle-3"})],-1)),a("div",{class:F(["login-container",{appear:P.value}])},[e[11]||(e[11]=a("div",{class:"login-header"},[a("h2",{class:"fade-in-down"},"欢迎登录电影购票系统"),a("div",{class:"underline"})],-1)),o(E,{ref_key:"formRef",ref:b,model:r.form,rules:r.rules,class:"fade-in-up"},{default:s(()=>[o(i,{prop:"username"},{default:s(()=>[o(l,{"prefix-icon":m(B),size:"large",modelValue:r.form.username,"onUpdate:modelValue":e[0]||(e[0]=t=>r.form.username=t),placeholder:"请输入账号",class:"custom-input"},null,8,["prefix-icon","modelValue"])]),_:1}),o(i,{prop:"password"},{default:s(()=>[o(l,{"show-password":"","prefix-icon":m(V),size:"large",modelValue:r.form.password,"onUpdate:modelValue":e[1]||(e[1]=t=>r.form.password=t),placeholder:"请输入密码",class:"custom-input"},null,8,["prefix-icon","modelValue"])]),_:1}),o(i,{prop:"role"},{default:s(()=>[o(U,{size:"large",modelValue:r.form.role,"onUpdate:modelValue":e[2]||(e[2]=t=>r.form.role=t),placeholder:"请选择角色",class:"custom-select"},{default:s(()=>[o(p,{value:"ADMIN",label:"管理员"}),o(p,{value:"CINEMA",label:"电影院"}),o(p,{value:"USER",label:"用户"})]),_:1},8,["modelValue"])]),_:1}),o(i,null,{default:s(()=>[o(f,{size:"large",type:"primary",class:F(["login-btn",{"button-loading":r.loading}]),onClick:I},{default:s(()=>[r.loading?(_(),w("span",Q)):(_(),w("span",G,"登 录"))]),_:1},8,["class"])]),_:1}),a("div",X,[o(h,{type:"primary",onClick:S,class:"custom-link"},{default:s(()=>e[9]||(e[9]=[u("忘记密码？")])),_:1}),o(h,{type:"primary",onClick:e[3]||(e[3]=t=>n.$router.push("/register")),class:"custom-link"},{default:s(()=>e[10]||(e[10]=[u("注册账号")])),_:1})])]),_:1},8,["model","rules"])],2),o(R,{modelValue:r.forgetVisible,"onUpdate:modelValue":e[8]||(e[8]=t=>r.forgetVisible=t),title:"找回密码",width:"400px","destroy-on-close":"",class:"forget-dialog custom-dialog"},{footer:s(()=>[a("span",Y,[o(f,{onClick:e[7]||(e[7]=t=>r.forgetVisible=!1),class:"cancel-btn"},{default:s(()=>e[12]||(e[12]=[u("取消")])),_:1}),o(f,{type:"primary",onClick:C,class:"confirm-btn"},{default:s(()=>e[13]||(e[13]=[u("确定")])),_:1})])]),default:s(()=>[o(E,{model:r.forgetForm,rules:k,ref_key:"forgetFormRef",ref:y},{default:s(()=>[o(i,{prop:"phone"},{default:s(()=>[o(l,{modelValue:r.forgetForm.phone,"onUpdate:modelValue":e[4]||(e[4]=t=>r.forgetForm.phone=t),placeholder:"请输入手机号",class:"custom-input"},{prefix:s(()=>[o(c,null,{default:s(()=>[o(m(A))]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(i,{prop:"newPassword"},{default:s(()=>[o(l,{modelValue:r.forgetForm.newPassword,"onUpdate:modelValue":e[5]||(e[5]=t=>r.forgetForm.newPassword=t),type:"password",placeholder:"请输入新密码","show-password":"",class:"custom-input"},{prefix:s(()=>[o(c,null,{default:s(()=>[o(m(V))]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(i,{prop:"confirmPassword"},{default:s(()=>[o(l,{modelValue:r.forgetForm.confirmPassword,"onUpdate:modelValue":e[6]||(e[6]=t=>r.forgetForm.confirmPassword=t),type:"password",placeholder:"请确认新密码","show-password":"",class:"custom-input"},{prefix:s(()=>[o(c,null,{default:s(()=>[o(m(V))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ce=N(Z,[["__scopeId","data-v-8e188b6e"]]);export{ce as default};
