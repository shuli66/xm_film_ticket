import{_ as q,v as c,y as M,r as R,c as _,b as o,a as t,w as r,C as k,V as z,O as B,o as w,u as d,aK as L,aL as V,h as m,ay as A,E as u,d as b,K as T,T as $,I as D,B as O,L as K,aM as j,m as H}from"./index-DNfxLx3V.js";/* empty css               *//* empty css                *//* empty css                  *//* empty css             *//* empty css               *//* empty css            *//* empty css               *//* empty css                  *//* empty css               *//* empty css              */import{r as x}from"./request-B9NmRS_H.js";import{S as J}from"./SnowEffect-DQdwihrC.js";const G={class:"login-wrapper"},Q={key:0},W={key:1,class:"loading-spinner"},X={class:"login-actions fade-in"},Y={class:"dialog-footer"},Z={__name:"Login",setup(ee){const v=c(),y=c(),E=c(!1);M(()=>{setTimeout(()=>{E.value=!0},300)});const s=R({form:{},forgetForm:{phone:"",newPassword:"",confirmPassword:""},forgetVisible:!1,loading:!1,rules:{username:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"blur"}]}}),C={phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(i,e,a)=>{e!==s.forgetForm.newPassword?a(new Error("两次输入的密码不一致")):a()},trigger:"blur"}]},I=()=>{v.value.validate(i=>{i&&(s.loading=!0,x.post("/login",s.form).then(e=>{e.code==="200"?(u.success("登录成功"),localStorage.setItem("xm-user",JSON.stringify(e.data)),sessionStorage.setItem("just_logged_in","true"),setTimeout(()=>{e.data.role==="USER"&&b.push("/front/home"),e.data.role==="CINEMA"&&b.push("/manager/home"),e.data.role==="ADMIN"&&b.push("/manager/adminHome")},800)):(u.error(e.msg),s.loading=!1)}).catch(()=>{s.loading=!1}))})},h=()=>{s.forgetVisible=!0,s.forgetForm={phone:"",newPassword:"",confirmPassword:""}},U=()=>{y.value.validate(i=>{i&&x.post("/user/resetPassword",s.forgetForm).then(e=>{e.code==="200"?(u({type:"success",message:"密码重置成功，请使用新密码登录",duration:3e3}),s.forgetVisible=!1,s.forgetForm={phone:"",newPassword:"",confirmPassword:""}):u({type:"error",message:e.msg||"密码重置失败",duration:3e3})}).catch(e=>{u({type:"error",message:"系统错误，请稍后重试",duration:3e3})})})};return(i,e)=>{const a=T,n=$,p=D,N=O,f=K,P=j,F=z,g=H,S=B;return w(),_("div",G,[o(J),e[14]||(e[14]=t("div",{class:"floating-circles"},[t("div",{class:"circle circle-1"}),t("div",{class:"circle circle-2"}),t("div",{class:"circle circle-3"})],-1)),t("div",{class:k(["login-container",{appear:E.value}])},[e[11]||(e[11]=t("div",{class:"login-header"},[t("h2",{class:"fade-in-down"},"欢迎登录电影购票系统"),t("div",{class:"underline"})],-1)),o(F,{ref_key:"formRef",ref:v,model:s.form,rules:s.rules,class:"fade-in-up"},{default:r(()=>[o(n,{prop:"username"},{default:r(()=>[o(a,{"prefix-icon":d(L),size:"large",modelValue:s.form.username,"onUpdate:modelValue":e[0]||(e[0]=l=>s.form.username=l),placeholder:"请输入账号",class:"custom-input"},null,8,["prefix-icon","modelValue"])]),_:1}),o(n,{prop:"password"},{default:r(()=>[o(a,{"show-password":"","prefix-icon":d(V),size:"large",modelValue:s.form.password,"onUpdate:modelValue":e[1]||(e[1]=l=>s.form.password=l),placeholder:"请输入密码",class:"custom-input"},null,8,["prefix-icon","modelValue"])]),_:1}),o(n,{prop:"role"},{default:r(()=>[o(N,{size:"large",modelValue:s.form.role,"onUpdate:modelValue":e[2]||(e[2]=l=>s.form.role=l),placeholder:"请选择角色",class:"custom-select"},{default:r(()=>[o(p,{value:"ADMIN",label:"管理员"}),o(p,{value:"CINEMA",label:"电影院"}),o(p,{value:"USER",label:"用户"})]),_:1},8,["modelValue"])]),_:1}),o(n,null,{default:r(()=>[o(f,{size:"large",type:"primary",class:k(["login-btn",{"button-loading":s.loading}]),onClick:I},{default:r(()=>[s.loading?(w(),_("span",W)):(w(),_("span",Q,"登 录"))]),_:1},8,["class"])]),_:1}),t("div",X,[o(P,{type:"primary",onClick:h,class:"custom-link"},{default:r(()=>e[9]||(e[9]=[m("忘记密码？")])),_:1}),o(P,{type:"primary",onClick:e[3]||(e[3]=l=>i.$router.push("/register")),class:"custom-link"},{default:r(()=>e[10]||(e[10]=[m("注册账号")])),_:1})])]),_:1},8,["model","rules"])],2),o(S,{modelValue:s.forgetVisible,"onUpdate:modelValue":e[8]||(e[8]=l=>s.forgetVisible=l),title:"找回密码",width:"400px","destroy-on-close":"",class:"forget-dialog custom-dialog"},{footer:r(()=>[t("span",Y,[o(f,{onClick:e[7]||(e[7]=l=>s.forgetVisible=!1),class:"cancel-btn"},{default:r(()=>e[12]||(e[12]=[m("取消")])),_:1}),o(f,{type:"primary",onClick:U,class:"confirm-btn"},{default:r(()=>e[13]||(e[13]=[m("确定")])),_:1})])]),default:r(()=>[o(F,{model:s.forgetForm,rules:C,ref_key:"forgetFormRef",ref:y},{default:r(()=>[o(n,{prop:"phone"},{default:r(()=>[o(a,{modelValue:s.forgetForm.phone,"onUpdate:modelValue":e[4]||(e[4]=l=>s.forgetForm.phone=l),placeholder:"请输入手机号",class:"custom-input"},{prefix:r(()=>[o(g,null,{default:r(()=>[o(d(A))]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(n,{prop:"newPassword"},{default:r(()=>[o(a,{modelValue:s.forgetForm.newPassword,"onUpdate:modelValue":e[5]||(e[5]=l=>s.forgetForm.newPassword=l),type:"password",placeholder:"请输入新密码","show-password":"",class:"custom-input"},{prefix:r(()=>[o(g,null,{default:r(()=>[o(d(V))]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(n,{prop:"confirmPassword"},{default:r(()=>[o(a,{modelValue:s.forgetForm.confirmPassword,"onUpdate:modelValue":e[6]||(e[6]=l=>s.forgetForm.confirmPassword=l),type:"password",placeholder:"请确认新密码","show-password":"",class:"custom-input"},{prefix:r(()=>[o(g,null,{default:r(()=>[o(d(V))]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},ge=q(Z,[["__scopeId","data-v-11b9e389"]]);export{ge as default};
