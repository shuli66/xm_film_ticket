import{v as N,r as L,c as y,a as b,i as f,j as _,b as o,w as n,E as r,J as I,K as $,L as X,M as j,N as H,O as K,o as c,h as p,u as h,P as Q,Q as W,F as G,z as Y,R as Z,I as ee,B as ae,T as le,V as te}from"./index-DNfxLx3V.js";/* empty css               *//* empty css                *//* empty css                  *//* empty css            *//* empty css               *//* empty css                  *//* empty css               *//* empty css                   *//* empty css                     *//* empty css                 *//* empty css                *//* empty css               *//* empty css              */import{r as g}from"./request-B9NmRS_H.js";/* empty css                    */const oe={class:"card",style:{"margin-bottom":"5px"}},ne={class:"card",style:{"margin-bottom":"5px"}},re={class:"card",style:{"margin-bottom":"5px"}},se={key:0,class:"card"},ie={class:"dialog-footer"},ke={__name:"Room",setup(me){const V=N(),s=N({}),i=N(null),D={name:[{required:!0,message:"请输入影厅名称",trigger:"blur"}],cinemaId:[{required:!0,message:"请选择所属影院",trigger:"change"}]},a=L({user:JSON.parse(localStorage.getItem("xm-user")||"{}"),formVisible:!1,tableData:[],pageNum:1,pageSize:8,total:0,name:null,cinemaName:null,ids:[],cinemaData:[]}),k=()=>{a.user.role==="ADMIN"&&g.get("/cinema/selectAll").then(l=>{l.code==="200"?(a.cinemaData=l.data,console.log("加载的影院数据:",a.cinemaData)):r.error(l.msg)})},d=()=>{g.get("/room/selectPage",{params:{pageNum:a.pageNum,pageSize:a.pageSize,name:a.name,cinemaName:a.cinemaName}}).then(l=>{var e,m;l.code==="200"?(a.tableData=((e=l.data)==null?void 0:e.list)||[],a.total=(m=l.data)==null?void 0:m.total):r.error(l.msg)})},x=()=>{s.value={},i.value=null,a.user.role==="CINEMA"&&(i.value=a.user.id),a.formVisible=!0},E=l=>{s.value=JSON.parse(JSON.stringify(l)),i.value=l.cinemaId,console.log("编辑影厅，影院ID:",i.value),a.formVisible=!0},w=()=>{const l={name:s.value.name,cinemaId:a.user.role==="ADMIN"?i.value:a.user.id};console.log("添加影厅，发送到后端的数据:",l),g.post("/room/add",l).then(e=>{e.code==="200"?(r.success("操作成功"),a.formVisible=!1,d()):r.error(e.msg)})},M=()=>{const l={id:s.value.id,name:s.value.name,cinemaId:a.user.role==="ADMIN"?i.value:s.value.cinemaId};console.log("更新影厅，发送到后端的数据:",l),g.put("/room/update",l,{headers:{"Cache-Control":"no-cache",Pragma:"no-cache","X-Requested-With":"XMLHttpRequest",timestamp:new Date().getTime()}}).then(e=>{e.code==="200"?(console.log("更新成功，后端响应:",e),r.success("操作成功"),a.formVisible=!1,setTimeout(()=>{d()},300)):(r.error(e.msg||"更新失败"),console.error("更新失败，错误信息:",e))}).catch(e=>{console.error("更新请求异常:",e),r.error("请求异常: "+(e.message||e))})},A=()=>{V.value.validate(l=>{if(l){if(a.user.role==="ADMIN"&&!i.value){r.warning("请选择所属影院");return}console.log("保存影厅，选中的影院ID:",i.value),s.value.id?M():w()}})},S=l=>{I.confirm("删除后数据无法恢复，您确定删除吗？","删除确认",{type:"warning"}).then(e=>{g.delete("/room/delete/"+l).then(m=>{m.code==="200"?(r.success("删除成功"),d()):r.error(m.msg)})}).catch(e=>{console.error(e)})},B=()=>{if(!a.ids.length){r.warning("请选择数据");return}I.confirm("删除后数据无法恢复，您确定删除吗？","删除确认",{type:"warning"}).then(l=>{g.delete("/room/delete/batch",{data:a.ids}).then(e=>{e.code==="200"?(r.success("操作成功"),d()):r.error(e.msg)})}).catch(l=>{console.error(l)})},z=l=>{a.ids=l.map(e=>e.id)},R=()=>{a.name=null,a.cinemaName=null,d()};return k(),d(),(l,e)=>{const m=$,u=X,v=Z,T=j,U=H,q=ee,O=ae,C=le,P=te,F=K;return c(),y("div",null,[b("div",oe,[a.user.role==="ADMIN"?(c(),f(m,{key:0,modelValue:a.cinemaName,"onUpdate:modelValue":e[0]||(e[0]=t=>a.cinemaName=t),"prefix-icon":"Search",style:{width:"240px","margin-right":"10px"},placeholder:"请输入影院名称查询"},null,8,["modelValue"])):_("",!0),o(m,{modelValue:a.name,"onUpdate:modelValue":e[1]||(e[1]=t=>a.name=t),"prefix-icon":"Search",style:{width:"240px","margin-right":"10px"},placeholder:"请输入影厅名称查询"},null,8,["modelValue"]),o(u,{type:"info",plain:"",onClick:d},{default:n(()=>e[7]||(e[7]=[p("查询")])),_:1}),o(u,{type:"warning",plain:"",style:{margin:"0 10px"},onClick:R},{default:n(()=>e[8]||(e[8]=[p("重置")])),_:1})]),b("div",ne,[a.user.role==="CINEMA"||a.user.role==="ADMIN"?(c(),f(u,{key:0,type:"primary",plain:"",onClick:x},{default:n(()=>e[9]||(e[9]=[p("新增")])),_:1})):_("",!0),o(u,{type:"danger",plain:"",onClick:B},{default:n(()=>e[10]||(e[10]=[p("批量删除")])),_:1})]),b("div",re,[o(T,{stripe:"",data:a.tableData,onSelectionChange:z},{default:n(()=>[o(v,{type:"selection",width:"55"}),o(v,{prop:"cinemaName",label:"影院名称"}),o(v,{prop:"name",label:"影厅名称"}),o(v,{label:"操作",width:"100",fixed:"right"},{default:n(t=>[a.user.role==="CINEMA"||a.user.role==="ADMIN"?(c(),f(u,{key:0,type:"primary",circle:"",icon:h(Q),onClick:J=>E(t.row)},null,8,["icon","onClick"])):_("",!0),o(u,{type:"danger",circle:"",icon:h(W),onClick:J=>S(t.row.id)},null,8,["icon","onClick"])]),_:1})]),_:1},8,["data"])]),a.total?(c(),y("div",se,[o(U,{onCurrentChange:d,background:"",layout:"prev, pager, next","page-size":a.pageSize,"current-page":a.pageNum,"onUpdate:currentPage":e[2]||(e[2]=t=>a.pageNum=t),total:a.total},null,8,["page-size","current-page","total"])])):_("",!0),o(F,{title:"影厅信息",modelValue:a.formVisible,"onUpdate:modelValue":e[6]||(e[6]=t=>a.formVisible=t),width:"40%","destroy-on-close":""},{footer:n(()=>[b("span",ie,[o(u,{onClick:e[5]||(e[5]=t=>a.formVisible=!1)},{default:n(()=>e[11]||(e[11]=[p("取 消")])),_:1}),o(u,{type:"primary",onClick:A},{default:n(()=>e[12]||(e[12]=[p("确 定")])),_:1})])]),default:n(()=>[o(P,{ref_key:"formRef",ref:V,rules:D,model:s.value,"label-width":"80px",style:{padding:"20px"}},{default:n(()=>[a.user.role==="ADMIN"?(c(),f(C,{key:0,prop:"cinemaId",label:"所属影院"},{default:n(()=>[o(O,{modelValue:i.value,"onUpdate:modelValue":e[3]||(e[3]=t=>i.value=t),placeholder:"请选择所属影院"},{default:n(()=>[(c(!0),y(G,null,Y(a.cinemaData,t=>(c(),f(q,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})):_("",!0),o(C,{prop:"name",label:"影厅名称"},{default:n(()=>[o(m,{modelValue:s.value.name,"onUpdate:modelValue":e[4]||(e[4]=t=>s.value.name=t),placeholder:"请输入影厅名称"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};export{ke as default};
