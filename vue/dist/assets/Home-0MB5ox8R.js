import{_ as Y,r as j,y as A,c as r,a as t,b as n,w as l,t as a,F as g,z as h,E as _,O as L,X as R,o as c,u as C,ak as U,h as p,al as q,C as G,i as k,j as X,am as K,a6 as Q,m as W,G as Z,an as tt,a8 as ot,ao as et,L as st,a7 as it}from"./index-DNfxLx3V.js";/* empty css            *//* empty css               *//* empty css                *//* empty css               *//* empty css                 *//* empty css              *//* empty css             *//* empty css            */import{r as u}from"./request-B9NmRS_H.js";import{S as at}from"./SnowEffect-DQdwihrC.js";const lt={class:"home-wrapper"},nt={class:"snow-container"},ct={class:"notice-popup-header"},dt={class:"notice-popup-title"},rt={key:0,class:"notice-popup-content"},_t={class:"notice-card-header"},mt={class:"notice-card-title"},pt={class:"title-text"},ut={class:"notice-card-meta"},vt={class:"notice-card-time"},ft={class:"notice-card-content"},gt={class:"content-text"},ht={key:1,class:"notice-empty"},yt={class:"notice-popup-footer"},kt={class:"home-container"},Nt={class:"main-content"},St={class:"section-header"},Tt={class:"section-title"},bt={class:"title-count"},Ct={class:"movie-grid"},xt=["onClick"],wt=["src","alt"],Dt={class:"movie-overlay"},Vt={class:"section-header"},$t={class:"section-title"},Et={class:"title-count"},It={class:"movie-grid"},Ft=["onClick"],Pt=["src","alt"],Bt={class:"movie-overlay"},Ot={class:"section-header"},zt={class:"section-title"},Ht={class:"title-count"},Jt={class:"movie-grid"},Mt=["onClick"],Yt=["src","alt"],jt={class:"movie-info"},At={class:"movie-title"},Lt={class:"release-date"},Rt={class:"sidebar"},Ut={class:"section-header"},qt={class:"rankings-box"},Gt={class:"top-movie"},Xt=["src","alt"],Kt={class:"top-movie-info"},Qt={class:"top-movie-title"},Wt={class:"top-movie-total"},Zt={class:"rankings-list"},to=["onClick"],oo={class:"rank-number"},eo={class:"rank-title"},so={class:"rank-total"},io={class:"today-box"},ao={class:"today-header"},lo={class:"today-content"},no={class:"today-total"},co={class:"today-time"},ro={class:"section-header"},_o={class:"rankings-box"},mo={class:"top-movie"},po=["src","alt"],uo={class:"top-movie-info"},vo={class:"top-movie-title"},fo={class:"top-movie-score"},go={class:"rankings-list"},ho=["onClick"],yo={class:"rank-number"},ko={class:"rank-title"},No={class:"rank-score"},So={__name:"Home",setup(To){const o=j({data1:[],data2:[],playingData:[],noPlayData:[],firstTotal:{},topTotal:[],firstScore:{},topScore:[],todayTotal:0,time:null,recommended:[],noticeVisible:!1,currentNotice:null,noticeNoShow:!1}),E=s=>s?Q(s).format("YYYY-MM-DD HH:mm"):"",x=()=>{localStorage.removeItem("xm-notice-noshow"),o.noticeNoShow=!1,localStorage.removeItem("xm-read-notices"),JSON.parse(localStorage.getItem("xm-user")||"{}").id,sessionStorage.setItem("just_logged_in","true"),u.get("/notice/selectAll").then(e=>{if(e.code==="200"&&e.data&&e.data.length>0){const y=[...e.data.map(f=>({...f,important:!0}))].sort((f,N)=>new Date(N.time)-new Date(f.time));o.currentNotice=y[0],setTimeout(()=>{o.noticeVisible=!0},300)}}).catch(e=>{console.error("加载公告失败",e)})},I=()=>{console.log("用户选择了不再提示，设置标记")},w=()=>{u.get("/orders/todayTotal").then(s=>{s.code==="200"?(o.todayTotal=s.data.total,o.time=s.data.time):_.error(s.msg)})},F=()=>{u.get("/film/selectTotalTop").then(s=>{s.code==="200"?(o.firstTotal=s.data[0],o.topTotal=s.data.slice(1,s.data.length)):_.error(s.msg)})},P=()=>{u.get("/film/selectScoreTop").then(s=>{s.code==="200"?(o.firstScore=s.data[0],o.topScore=s.data.slice(1,s.data.length)):_.error(s.msg)})},B=()=>{console.log("加载推荐电影...");const s=JSON.parse(localStorage.getItem("xm-user")),e=s?s.id:null;if(console.log(e),!e){_.error("用户未登录");return}u.get(`/api/recommendations/${e}`).then(d=>{console.log("API 请求结果:",d),d.code==="200"?(console.log(o.recommended),o.recommended=d.data):_.error(d.msg)}).catch(d=>{_.error("加载推荐电影失败"),console.error(d)})},O=()=>{setTimeout(()=>{o.currentNotice?o.noticeVisible=!0:(x(),setTimeout(()=>{o.noticeVisible=!0},500))},800)};w(),F(),P(),B();const v=s=>{location.href=s};(()=>{u.get("/film/selectAll").then(s=>{s.code==="200"?(o.data1=s.data.filter(e=>e.status==="已上映"),o.data2=s.data.filter(e=>e.status==="待上映"),o.data1&&o.data1.length>8?o.playingData=o.data1.slice(0,8):o.playingData=o.data1,o.data2&&o.data2.length>8?o.noPlayData=o.data2.slice(0,8):o.noPlayData=o.data2):_.error(s.msg)})})();const z=()=>{if(o.noticeVisible=!1,o.currentNotice){const e=JSON.parse(localStorage.getItem("xm-read-notices")||"[]").filter(d=>d!==o.currentNotice.id);localStorage.setItem("xm-read-notices",JSON.stringify(e))}};return A(()=>{x(),O()}),(s,e)=>{var D,V,$;const d=W,y=Z,f=tt,N=ot,H=et,S=st,J=L,T=it,b=R;return c(),r("div",lt,[t("div",nt,[n(at)]),n(J,{modelValue:o.noticeVisible,"onUpdate:modelValue":e[1]||(e[1]=i=>o.noticeVisible=i),"destroy-on-close":"","show-close":!0,center:"",width:"750px","custom-class":"notice-popup-dialog","append-to-body":""},{header:l(()=>[t("div",ct,[t("div",dt,[n(d,{class:"notice-icon"},{default:l(()=>[n(C(U))]),_:1}),e[7]||(e[7]=t("span",null,"系统公告",-1))])])]),footer:l(()=>[t("div",yt,[n(H,{modelValue:o.noticeNoShow,"onUpdate:modelValue":e[0]||(e[0]=i=>o.noticeNoShow=i),label:"不再提示",onChange:I},null,8,["modelValue"]),n(S,{type:"primary",onClick:z,class:"close-btn"},{default:l(()=>[e[11]||(e[11]=p(" 关闭 ")),n(d,{class:"el-icon--right"},{default:l(()=>[n(C(q))]),_:1})]),_:1})])]),default:l(()=>[o.currentNotice?(c(),r("div",rt,[n(f,{class:G(["notice-popup-card",{"notice-card-important":o.currentNotice.important}])},{header:l(()=>[t("div",_t,[t("div",mt,[o.currentNotice.important?(c(),k(y,{key:0,type:"danger",size:"default",effect:"dark",class:"notice-tag"},{default:l(()=>e[8]||(e[8]=[p(" 重要 ")])),_:1})):X("",!0),n(y,{type:"success",size:"default",effect:"light",class:"notice-tag"},{default:l(()=>e[9]||(e[9]=[p(" 新 ")])),_:1}),t("span",pt,a(o.currentNotice.title||"系统公告"),1)]),t("div",ut,[t("span",vt,[n(d,null,{default:l(()=>[n(C(K))]),_:1}),p(" "+a(E(o.currentNotice.time)),1)])])])]),default:l(()=>[t("div",ft,[t("pre",gt,a(o.currentNotice.content),1)])]),_:1},8,["class"]),e[10]||(e[10]=t("div",{class:"notice-decoration"},[t("div",{class:"notice-decoration-circle circle-1"}),t("div",{class:"notice-decoration-circle circle-2"}),t("div",{class:"notice-decoration-circle circle-3"})],-1))])):(c(),r("div",ht,[n(N,{description:"暂无公告"})]))]),_:1},8,["modelValue"]),t("div",kt,[t("div",Nt,[t("div",St,[t("div",Tt,[e[12]||(e[12]=t("span",{class:"title-text"},"为你推荐",-1)),t("span",bt,"("+a((D=o.recommended)==null?void 0:D.length)+"部)",1)]),t("div",{class:"view-all",onClick:e[2]||(e[2]=i=>s.$router.push("/front/film?category=recommended"))},"全部 >")]),t("div",Ct,[n(b,{gutter:20},{default:l(()=>[(c(!0),r(g,null,h(o.recommended,i=>(c(),k(T,{span:6,key:i.id,class:"movie-card"},{default:l(()=>[t("div",{class:"movie-poster",onClick:m=>v("/front/filmDetail?id="+i.id)},[t("img",{src:i.img,alt:i.title,class:"poster-image"},null,8,wt),t("div",Dt,[n(S,{type:"primary",class:"buy-ticket-btn"},{default:l(()=>e[13]||(e[13]=[p("购票")])),_:1})])],8,xt)]),_:2},1024))),128))]),_:1})]),t("div",Vt,[t("div",$t,[e[14]||(e[14]=t("span",{class:"title-text"},"正在热播",-1)),t("span",Et,"("+a((V=o.data1)==null?void 0:V.length)+"部)",1)]),t("div",{class:"view-all",onClick:e[3]||(e[3]=i=>s.$router.push("/front/film?category=playing"))},"全部 >")]),t("div",It,[n(b,{gutter:20},{default:l(()=>[(c(!0),r(g,null,h(o.playingData,i=>(c(),k(T,{span:6,key:i.id,class:"movie-card"},{default:l(()=>[t("div",{class:"movie-poster",onClick:m=>v("/front/filmDetail?id="+i.id)},[t("img",{src:i.img,alt:i.title,class:"poster-image"},null,8,Pt),t("div",Bt,[n(S,{type:"primary",class:"buy-ticket-btn"},{default:l(()=>e[15]||(e[15]=[p("购票")])),_:1})])],8,Ft)]),_:2},1024))),128))]),_:1})]),t("div",Ot,[t("div",zt,[e[16]||(e[16]=t("span",{class:"title-text"},"即将上映",-1)),t("span",Ht,"("+a(($=o.data2)==null?void 0:$.length)+"部)",1)]),t("div",{class:"view-all",onClick:e[4]||(e[4]=i=>s.$router.push("/front/film?category=upcoming"))},"全部 >")]),t("div",Jt,[n(b,{gutter:20},{default:l(()=>[(c(!0),r(g,null,h(o.noPlayData,i=>(c(),k(T,{span:6,key:i.id,class:"movie-card"},{default:l(()=>[t("div",{class:"movie-poster",onClick:m=>v("/front/filmDetail?id="+i.id)},[t("img",{src:i.img,alt:i.title,class:"poster-image"},null,8,Yt),t("div",jt,[t("div",At,a(i.title),1),t("div",Lt,a(i.start)+" 上映",1)])],8,Mt)]),_:2},1024))),128))]),_:1})])]),t("div",Rt,[t("div",Ut,[e[17]||(e[17]=t("div",{class:"section-title"},[t("span",{class:"title-text"},"总票房Top 10")],-1)),t("div",{class:"view-all",onClick:e[5]||(e[5]=i=>s.$router.push("/front/charts"))},"查看完整榜单 >")]),t("div",qt,[t("div",Gt,[t("img",{src:o.firstTotal.img,alt:o.firstTotal.title,class:"top-movie-poster"},null,8,Xt),t("div",Kt,[t("div",Qt,a(o.firstTotal.title),1),t("div",Wt,a((o.firstTotal.total*1).toFixed(2))+"元",1)])]),t("div",Zt,[(c(!0),r(g,null,h(o.topTotal,(i,m)=>(c(),r("div",{key:i.id,class:"ranking-item",onClick:M=>v("/front/filmDetail?id="+i.id)},[t("div",oo,a(m+2),1),t("div",eo,a(i.title),1),t("div",so,a((i.total*1).toFixed(2))+"元",1)],8,to))),128))])]),t("div",io,[t("div",ao,[e[18]||(e[18]=t("div",{class:"today-label"},"今日票房",-1)),t("div",lo,[t("div",no,a(o.todayTotal.toFixed(2))+"元",1),t("div",co,"北京时间："+a(o.time),1)])]),t("div",{class:"update-btn",onClick:w},"点击更新")]),t("div",ro,[e[19]||(e[19]=t("div",{class:"section-title"},[t("span",{class:"title-text"},"总评分Top 10")],-1)),t("div",{class:"view-all",onClick:e[6]||(e[6]=i=>s.$router.push("/front/charts"))},"查看完整榜单 >")]),t("div",_o,[t("div",mo,[t("img",{src:o.firstScore.img,alt:o.firstScore.title,class:"top-movie-poster"},null,8,po),t("div",uo,[t("div",vo,a(o.firstScore.title),1),t("div",fo,a((o.firstScore.score*1).toFixed(1))+"分",1)])]),t("div",go,[(c(!0),r(g,null,h(o.topScore,(i,m)=>(c(),r("div",{key:i.id,class:"ranking-item",onClick:M=>v("/front/filmDetail?id="+i.id)},[t("div",yo,a(m+2),1),t("div",ko,a(i.title),1),t("div",No,a((i.score*1).toFixed(1))+"分",1)],8,ho))),128))])])])])])}}},Oo=Y(So,[["__scopeId","data-v-a39553ee"]]);export{Oo as default};
