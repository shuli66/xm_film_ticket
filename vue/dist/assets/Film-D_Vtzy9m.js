import{_ as P,r as U,y as Y,E as g,c as n,a as s,C as r,F as C,z as k,W as j,b as c,w as i,j as m,ap as G,X as J,a8 as O,N as W,Z as X,o,t as u,i as F,aq as Z,h as f,u as z,ar as H,as as K,ag as Q,m as tt,L as et,G as at,a7 as lt,d as st}from"./index-DNfxLx3V.js";/* empty css                *//* empty css                   *//* empty css            *//* empty css               *//* empty css                  *//* empty css               *//* empty css              *//* empty css            *//* empty css               *//* empty css             */import{r as _}from"./request-B9NmRS_H.js";const ot={class:"film-wrapper"},it={class:"film-container"},nt={class:"category-tabs"},rt={class:"filter-section"},ct={class:"filter-group"},dt={class:"filter-options"},gt=["onClick"],ut={class:"filter-group"},pt={class:"filter-options"},vt=["onClick"],mt={class:"filter-group"},ft={class:"filter-options"},_t=["onClick"],yt={class:"movie-list"},Ct={class:"movie-item"},kt=["onClick"],Ft=["src","alt"],ht={class:"movie-overlay"},Dt={class:"movie-rating"},bt={class:"movie-info"},$t={class:"movie-title"},wt={class:"movie-meta"},Et={class:"movie-status"},Nt={class:"movie-score"},zt={class:"score-value"},xt={key:0,class:"empty-state"},Vt={key:0,class:"pagination-container"},St={__name:"Film",setup(Bt){const x=G(),t=U({activeCategory:"all",typeFlag:null,areaFlag:null,yearFlag:null,typeData:[],areaData:[],yearData:[],pageNum:1,pageSize:8,total:0,filmData:[],loading:!1});Y(()=>{const l=x.query.category;l&&(t.activeCategory=l),p(),S(),B(),I()});const y=l=>{t.activeCategory=l,w(),p()},p=()=>{if(t.loading=!0,t.activeCategory==="recommended")V();else{let l={pageNum:t.pageNum,pageSize:t.pageSize,typeId:t.typeFlag,areaId:t.areaFlag,year:t.yearFlag};t.activeCategory==="playing"?l.status="已上映":t.activeCategory==="upcoming"&&(l.status="待上映"),_.get("/film/selectPage",{params:l}).then(a=>{a.code==="200"?(t.filmData=a.data.list,t.total=a.data.total):g.error(a.msg)}).finally(()=>{t.loading=!1})}},V=()=>{const l=JSON.parse(localStorage.getItem("xm-user")),a=l?l.id:null;if(!a){g.warning("请先登录以获取个性化推荐"),t.filmData=[],t.total=0,t.loading=!1;return}_.get(`/api/recommendations/${a}`).then(d=>{d.code==="200"?(t.filmData=d.data,t.total=d.data.length):(g.error(d.msg),t.filmData=[],t.total=0)}).catch(d=>{g.error("加载推荐电影失败"),console.error(d),t.filmData=[],t.total=0}).finally(()=>{t.loading=!1})},S=()=>{_.get("/type/selectAll").then(l=>{l.code==="200"?t.typeData=l.data:g.error(l.msg)})},B=()=>{_.get("/area/selectAll").then(l=>{l.code==="200"?t.areaData=l.data:g.error(l.msg)})},I=()=>{_.get("/getYear").then(l=>{l.code==="200"?t.yearData=l.data:g.error(l.msg)})},D=l=>{t.typeFlag=l,p()},b=l=>{t.yearFlag=l,p()},$=l=>{t.areaFlag=l,p()},T=l=>{if(l.status!=="已上映"){g.warning("该电影暂未上映，敬请期待！");return}st.push("/front/filmDetail?id="+l.id)},w=()=>{t.typeFlag=null,t.areaFlag=null,t.yearFlag=null,t.pageNum=1};return(l,a)=>{const d=Q,E=tt,N=et,h=at,A=lt,R=J,q=O,L=W,M=X;return o(),n("div",ot,[s("div",it,[s("div",nt,[s("div",{class:r(["category-tab",{"active-tab":t.activeCategory==="all"}]),onClick:a[0]||(a[0]=e=>y("all"))},"全部影片",2),s("div",{class:r(["category-tab",{"active-tab":t.activeCategory==="playing"}]),onClick:a[1]||(a[1]=e=>y("playing"))},"正在热播",2),s("div",{class:r(["category-tab",{"active-tab":t.activeCategory==="upcoming"}]),onClick:a[2]||(a[2]=e=>y("upcoming"))},"即将上映",2),s("div",{class:r(["category-tab",{"active-tab":t.activeCategory==="recommended"}]),onClick:a[3]||(a[3]=e=>y("recommended"))},"为您推荐",2)]),s("div",rt,[s("div",ct,[a[8]||(a[8]=s("div",{class:"filter-label"},"类型：",-1)),s("div",dt,[s("div",{class:r(["filter-item",{"filter-active":!t.typeFlag}]),onClick:a[4]||(a[4]=e=>D(null))},"全部",2),(o(!0),n(C,null,k(t.typeData,e=>(o(),n("div",{class:r(["filter-item",{"filter-active":t.typeFlag===e.id}]),key:e.id,onClick:v=>D(e.id)},u(e.title),11,gt))),128))])]),s("div",ut,[a[9]||(a[9]=s("div",{class:"filter-label"},"年代：",-1)),s("div",pt,[s("div",{class:r(["filter-item",{"filter-active":!t.yearFlag}]),onClick:a[5]||(a[5]=e=>b(null))},"全部",2),(o(!0),n(C,null,k(t.yearData,e=>(o(),n("div",{class:r(["filter-item",{"filter-active":t.yearFlag===e}]),key:e,onClick:v=>b(e)},u(e),11,vt))),128))])]),s("div",mt,[a[10]||(a[10]=s("div",{class:"filter-label"},"区域：",-1)),s("div",ft,[s("div",{class:r(["filter-item",{"filter-active":!t.areaFlag}]),onClick:a[6]||(a[6]=e=>$(null))},"全部",2),(o(!0),n(C,null,k(t.areaData,e=>(o(),n("div",{class:r(["filter-item",{"filter-active":t.areaFlag===e.id}]),key:e.id,onClick:v=>$(e.id)},u(e.title),11,_t))),128))])])]),j((o(),n("div",yt,[c(R,{gutter:30},{default:i(()=>[(o(!0),n(C,null,k(t.filmData,e=>(o(),F(A,{span:6,key:e.id,class:"movie-card"},{default:i(()=>[s("div",Ct,[s("div",{class:"movie-poster",onClick:v=>l.$router.push("/front/filmDetail?id="+e.id)},[s("img",{src:e.img,alt:e.title},null,8,Ft),s("div",ht,[s("div",Dt,[c(d,{modelValue:e.score,"onUpdate:modelValue":v=>e.score=v,disabled:"","show-score":"","text-color":"#ff9900","score-template":"{value}分"},null,8,["modelValue","onUpdate:modelValue"])]),c(N,{type:"primary",class:"buy-ticket-btn",onClick:Z(v=>T(e),["stop"])},{default:i(()=>[a[11]||(a[11]=f(" 立即购票 ")),c(E,{class:"el-icon--right"},{default:i(()=>[c(z(H))]),_:1})]),_:2},1032,["onClick"])])],8,kt),s("div",bt,[s("div",$t,u(e.title),1),s("div",wt,[s("div",Et,[e.status==="待上映"?(o(),F(h,{key:0,type:"warning",effect:"light"},{default:i(()=>[f(u(e.status),1)]),_:2},1024)):m("",!0),e.status==="已上映"?(o(),F(h,{key:1,type:"success",effect:"light"},{default:i(()=>[f(u(e.status),1)]),_:2},1024)):m("",!0),e.status==="停止上映"?(o(),F(h,{key:2,type:"danger",effect:"light"},{default:i(()=>[f(u(e.status),1)]),_:2},1024)):m("",!0)]),s("div",Nt,[s("span",zt,u(e.score),1),a[12]||(a[12]=s("span",{class:"score-label"},"分",-1))])])])])]),_:2},1024))),128))]),_:1}),t.filmData.length===0&&!t.loading?(o(),n("div",xt,[c(q,{description:"暂无符合条件的电影"},{image:i(()=>[c(E,{size:60},{default:i(()=>[c(z(K))]),_:1})]),description:i(()=>a[13]||(a[13]=[s("p",{class:"empty-text"},"没有找到符合条件的电影，请尝试其他筛选条件",-1)])),default:i(()=>[c(N,{type:"primary",onClick:w},{default:i(()=>a[14]||(a[14]=[f("重置筛选条件")])),_:1})]),_:1})])):m("",!0)])),[[M,t.loading]]),t.total&&t.filmData.length>0?(o(),n("div",Vt,[c(L,{onCurrentChange:p,background:"",layout:"total, prev, pager, next, jumper","page-size":t.pageSize,"current-page":t.pageNum,"onUpdate:currentPage":a[7]||(a[7]=e=>t.pageNum=e),total:t.total},null,8,["page-size","current-page","total"])])):m("",!0)])])}}},Jt=P(St,[["__scopeId","data-v-210a913d"]]);export{Jt as default};
