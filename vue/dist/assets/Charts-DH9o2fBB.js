import{_ as N,r as P,av as $,y as V,c as r,a as t,b as f,w as y,F as h,z as k,E as D,aI as q,X as H,o as c,i as I,t as d,h as b,j as C,C as E,aq as G,D as F,d as J,aJ as R,L as X,a7 as K,at as Q}from"./index-DNfxLx3V.js";/* empty css            *//* empty css               *//* empty css               */import{r as T}from"./request-B9NmRS_H.js";const U={class:"charts-wrapper"},W={class:"banner-section"},Y=["onClick"],Z=["src","alt"],tt={class:"carousel-info"},et={class:"carousel-title"},st={class:"carousel-details"},ot={class:"carousel-rank"},at={key:0,class:"carousel-score"},nt={class:"carousel-total"},ct={class:"carousel-desc"},lt={key:0,class:"carousel-actors"},rt={class:"carousel-time"},it={class:"charts-container"},dt={class:"category-tabs"},pt=["onClick"],_t={class:"chart-card main-chart"},ut={class:"chart-header"},ht={class:"chart-title"},gt={key:0,class:"el-icon-trophy"},yt={key:1,class:"el-icon-star-on"},vt={key:2,class:"el-icon-video-camera"},ft={class:"detailed-ranking-list"},kt=["onClick"],Ct={class:"detailed-rank-poster"},bt=["src","alt"],Tt={class:"poster-hover"},wt={class:"detailed-rank-info"},mt={class:"detailed-rank-title"},Et={class:"detailed-rank-details"},St={class:"detailed-rank-tags"},$t={key:0},Dt={key:1},Ft={key:2},At={key:3},Mt={class:"detailed-rank-actors"},xt={key:0},Ot={key:1},zt={class:"detailed-rank-time"},jt={class:"detailed-rank-value"},Bt={class:"value-number box-office"},Lt={class:"value-number rating"},Nt={class:"value-number trending"},Pt={class:"chart-card side-charts"},Vt={key:0,class:"new-actor-list"},qt={class:"new-actor-avatar"},Ht={class:"new-actor-info"},It={class:"new-actor-name"},Gt={class:"new-actor-stats"},Jt={class:"new-actor-count"},Rt={class:"new-actor-hot"},Xt={key:1,class:"empty-data"},Kt={class:"chart-card side-charts"},Qt={class:"new-type-distribution"},Ut={key:0,class:"pie-chart-container"},Wt={class:"pie-chart"},Yt={class:"pie-legend"},Zt={class:"legend-name"},te={class:"legend-value"},ee={key:1,class:"empty-data"},se={__name:"Charts",setup(oe){const o=P({topTotal:[],topScore:[],categories:[{id:"boxOffice",name:"票房榜"},{id:"rating",name:"评分榜"},{id:"trending",name:"热度榜"}],activeCategory:"boxOffice",topActors:[],typeDistribution:[]}),A=$(()=>{switch(o.activeCategory){case"boxOffice":return"电影票房排行榜";case"rating":return"电影评分排行榜";case"trending":return"电影热度排行榜";default:return"电影排行榜"}}),M=$(()=>{if(o.activeCategory==="boxOffice")return o.topTotal;if(o.activeCategory==="rating")return o.topScore;if(o.activeCategory==="trending"){if(o.topTotal.length>0&&o.topScore.length>0){const a=[...o.topTotal];return a.sort((s,l)=>{const u=s.score?parseFloat(s.score):0,_=l.score?parseFloat(l.score):0,p=s.total?parseFloat(s.total):0,v=l.total?parseFloat(l.total):0,n=p*.7+u*30*.3;return v*.7+_*30*.3-n}),a}return o.topTotal}return[]}),x=()=>{T.get("/film/selectTotalTop").then(a=>{a.code==="200"?(o.topTotal=a.data,j(a.data),S()):D.error(a.msg)})},O=()=>{T.get("/film/selectScoreTop").then(a=>{a.code==="200"?(o.topScore=a.data,o.topTotal.length||S()):D.error(a.msg)})},S=()=>{const a=o.topTotal.length?o.topTotal:o.topScore,s=new Map,l=new Map;console.log("开始提取类型数据，电影数量:",a.length),a.forEach((n,e)=>{n.actors&&n.actors.length&&n.actors.forEach(i=>{s.set(i,(s.get(i)||0)+1)}),e<3&&console.log(`电影[${e}] ${n.title} 的类型数据:`,{types:n.types,type:n.type}),n.types&&n.types.length?n.types.forEach(i=>{i&&l.set(i,(l.get(i)||0)+1)}):n.type&&n.type.split(",").map(g=>g.trim()).forEach(g=>{g&&l.set(g,(l.get(g)||0)+1)})});const u=Array.from(s.entries()).sort((n,e)=>e[1]-n[1]).slice(0,10).map(n=>n[0]);o.topActors=u,console.log("提取到的类型种类数量:",l.size),l.size===0&&(console.warn("未能提取到任何类型数据，使用默认类型数据"),l.set("剧情",10),l.set("喜剧",8),l.set("动作",7),l.set("科幻",5),l.set("爱情",4),l.set("动画",3));let _=0;l.forEach(n=>{_+=n});const p=Array.from(l.entries()).sort((n,e)=>e[1]-n[1]).slice(0,6).map(n=>({name:n[0],count:n[1],percentage:Math.round(n[1]/_*100)}));let v=p.reduce((n,e)=>n+e.percentage,0);if(v!==100&&p.length>0){const n=100-v;p[0].percentage+=n}o.typeDistribution=p,console.log("生成的类型分布数据:",o.typeDistribution)},w=a=>{J.push({path:"/front/filmDetail",query:{id:a}})},z=a=>{o.activeCategory=a},m=a=>{const s=["#ff4d4f","#ffa940","#52c41a","#1890ff","#722ed1","#eb2f96"];return s[a%s.length]};Object.defineProperty(o,"categoryTitle",{get:()=>A.value}),Object.defineProperty(o,"displayList",{get:()=>M.value});const j=a=>{if(!a||!a.length)return;console.group("电影类型数据检查"),console.log("示例电影:",a[0]),console.log("电影总数:",a.length);let s=0,l=0,u=0,_=0;a.forEach(p=>{p.types&&p.types.length&&s++,p.type&&l++,p.types&&p.types.length&&p.type&&u++,(!p.types||!p.types.length)&&!p.type&&_++}),console.log("有types字段的电影数:",s),console.log("有type字段的电影数:",l),console.log("两种字段都有的电影数:",u),console.log("两种字段都没有的电影数:",_),a[0]&&(console.log("第一部电影types详情:",a[0].types),console.log("第一部电影type详情:",a[0].type)),console.groupEnd()};V(()=>{const a=T.get;T.get=function(...s){return a.apply(this,s).then(l=>((s[0]==="/film/selectTotalTop"||s[0]==="/film/selectScoreTop")&&console.log("电影数据结构:",s[0],l.data&&l.data[0]),l))}}),x(),O();const B=a=>Math.max(8-a,3),L=()=>{if(!o.typeDistribution.length)return[];const a=[];let s=0;return o.typeDistribution.forEach((l,u)=>{const _=l.percentage/100*360;a.push({style:{transform:`rotate(${s}deg)`,background:`conic-gradient(${m(u)} 0deg, ${m(u)} ${_}deg, transparent ${_}deg, transparent 360deg)`}}),s+=_}),a};return(a,s)=>{const l=R,u=q,_=X,p=K,v=Q,n=H;return c(),r("div",U,[t("div",W,[f(u,{height:"400px","indicator-position":"outside",arrow:"always",interval:5e3},{default:y(()=>[o.topTotal.length>0?(c(!0),r(h,{key:0},k(o.topTotal.slice(0,5),(e,i)=>(c(),I(l,{key:i},{default:y(()=>[t("div",{class:"carousel-content",onClick:g=>w(e.id)},[s[2]||(s[2]=t("div",{class:"carousel-overlay"},null,-1)),t("img",{src:e.img,alt:e.title,class:"carousel-image"},null,8,Z),t("div",tt,[t("h2",et,d(e.title),1),t("div",st,[t("div",ot,"TOP "+d(i+1),1),e.score?(c(),r("div",at,[s[1]||(s[1]=t("i",{class:"el-icon-star-on"},null,-1)),b(" "+d((e.score*1).toFixed(1)),1)])):C("",!0),t("div",nt,"票房: "+d((e.total*1).toFixed(2))+"元",1)]),t("div",ct,[e.actors&&e.actors.length?(c(),r("div",lt," 主演: "+d(e.actors.slice(0,3).join(" / ")),1)):C("",!0),t("div",rt,"上映日期: "+d(e.start),1)])])],8,Y)]),_:2},1024))),128)):C("",!0)]),_:1})]),t("div",it,[t("div",dt,[(c(!0),r(h,null,k(o.categories,e=>(c(),r("div",{key:e.id,class:E(["category-tab",o.activeCategory===e.id?"active-tab":""]),onClick:i=>z(e.id)},d(e.name),11,pt))),128))]),f(n,{gutter:30},{default:y(()=>[f(p,{span:17},{default:y(()=>[t("div",_t,[t("div",ut,[t("div",ht,[o.activeCategory==="boxOffice"?(c(),r("i",gt)):o.activeCategory==="rating"?(c(),r("i",yt)):o.activeCategory==="trending"?(c(),r("i",vt)):C("",!0),t("span",null,d(o.categoryTitle),1)]),t("div",{class:"view-all",onClick:s[0]||(s[0]=e=>a.$router.push("/front/film"))},"查看全部影片 >")]),t("div",ft,[(c(!0),r(h,null,k(o.displayList,(e,i)=>(c(),r("div",{key:e.id,class:"detailed-ranking-item",onClick:g=>w(e.id)},[t("div",{class:E(["detailed-rank-number",{"top-rank":i<3}])},d(i+1),3),t("div",Ct,[t("img",{src:e.img,alt:e.title},null,8,bt),t("div",Tt,[f(_,{type:"primary",size:"small",onClick:G(g=>w(e.id),["stop"])},{default:y(()=>s[3]||(s[3]=[b(" 查看详情 ")])),_:2},1032,["onClick"])])]),t("div",wt,[t("div",mt,d(e.title),1),t("div",Et,[t("div",St,[e.types&&e.types.length?(c(),r("span",$t,d(e.types.join(" / ")),1)):e.type?(c(),r("span",Dt,d(e.type),1)):(c(),r("span",Ft,"暂无类型信息")),e.duration?(c(),r("span",At,d(e.duration)+"分钟",1)):C("",!0)]),t("div",Mt,[e.actors&&e.actors.length?(c(),r("span",xt,"主演: "+d(e.actors.slice(0,3).join(" / ")),1)):(c(),r("span",Ot,"管理员暂未输入演职人员信息"))]),t("div",zt,d(e.start),1)])]),t("div",jt,[o.activeCategory==="boxOffice"?(c(),r(h,{key:0},[s[4]||(s[4]=t("div",{class:"value-label"},"总票房",-1)),t("div",Bt,d((e.total*1).toFixed(2))+"元",1)],64)):o.activeCategory==="rating"?(c(),r(h,{key:1},[s[6]||(s[6]=t("div",{class:"value-label"},"用户评分",-1)),t("div",Lt,[s[5]||(s[5]=t("i",{class:"el-icon-star-on"},null,-1)),b(" "+d((e.score*1).toFixed(1)),1)])],64)):(c(),r(h,{key:2},[s[7]||(s[7]=t("div",{class:"value-label"},"热度指数",-1)),t("div",Nt,d(Math.floor(e.total*10/(i+1))),1)],64))])],8,kt))),128))])])]),_:1}),f(p,{span:7},{default:y(()=>[t("div",Pt,[s[8]||(s[8]=t("div",{class:"chart-header"},[t("div",{class:"chart-title"},[t("i",{class:"el-icon-user"}),t("span",null,"热门演员榜")])],-1)),o.topActors.length>0?(c(),r("div",Vt,[(c(!0),r(h,null,k(o.topActors.slice(0,5),(e,i)=>(c(),r("div",{key:i,class:"new-actor-item"},[t("div",{class:E(["new-actor-rank",{"top-three":i<3}])},d(i+1),3),t("div",qt,[f(v,{size:40},{default:y(()=>[b(d(e.charAt(0)),1)]),_:2},1024)]),t("div",Ht,[t("div",It,d(e),1),t("div",Gt,[t("span",Jt,d(B(i))+"部作品",1),t("span",Rt,"热度 "+d(100-i*12),1)])])]))),128))])):(c(),r("div",Xt," 暂无演员数据 "))]),t("div",Kt,[s[10]||(s[10]=t("div",{class:"chart-header"},[t("div",{class:"chart-title"},[t("i",{class:"el-icon-pie-chart"}),t("span",null,"类型分布")])],-1)),t("div",Qt,[o.typeDistribution.length>0?(c(),r("div",Ut,[t("div",Wt,[(c(!0),r(h,null,k(L(),(e,i)=>(c(),r("div",{key:i,class:"pie-segment",style:F(e.style)},null,4))),128)),s[9]||(s[9]=t("div",{class:"pie-center"},[t("div",{class:"pie-center-text"},"类型")],-1))]),t("div",Yt,[(c(!0),r(h,null,k(o.typeDistribution,(e,i)=>(c(),r("div",{key:i,class:"legend-item"},[t("div",{class:"legend-color",style:F({backgroundColor:m(i)})},null,4),t("div",Zt,d(e.name),1),t("div",te,d(e.percentage)+"%",1)]))),128))])])):(c(),r("div",ee," 暂无类型数据 "))])])]),_:1})]),_:1})])])}}},ie=N(se,[["__scopeId","data-v-44089de3"]]);export{ie as default};
