import{_ as j,v,x as A,y as L,aC as O,o as u,c as m,a as M,D as Z,b as k,w as _,h as z,$ as I,F as K,z as R,t as C,j as P,E as f,L as V,K as D}from"./index-DNfxLx3V.js";/* empty css              *//* empty css               */const T={class:"map-container"},F={key:0,class:"search-box"},U={key:0,class:"search-results"},$=["onClick"],G={class:"address"},H={__name:"BaiduMap",props:{height:{type:Number,default:400},showSearch:{type:Boolean,default:!0},center:{type:Object,default:()=>({lng:116.404,lat:39.915})},zoom:{type:Number,default:15},defaultMarker:{type:Object,default:null},selectable:{type:Boolean,default:!0}},emits:["select-address"],setup(g,{expose:b,emit:N}){const s=g,w=N,B=v(null),n=v(null),d=v(""),l=v([]);let y=null,c=null;const x=()=>new Promise((e,t)=>{if(window.BMap){e(window.BMap);return}const a=document.createElement("script");a.type="text/javascript",a.src="https://api.map.baidu.com/api?v=3.0&ak=rmDZ0gPaWjBfUdkoewMXxHlbWyaEAW7E&callback=initBaiduMap",window.initBaiduMap=()=>{e(window.BMap)},a.onerror=t,document.head.appendChild(a)}),E=async()=>{try{await x(),n.value=new BMap.Map(B.value);const e=new BMap.Point(s.center.lng,s.center.lat);n.value.centerAndZoom(e,s.zoom),n.value.addControl(new BMap.NavigationControl),n.value.addControl(new BMap.ScaleControl),n.value.enableScrollWheelZoom(),s.defaultMarker&&p(new BMap.Point(s.defaultMarker.lng,s.defaultMarker.lat),s.defaultMarker.title),y=new BMap.LocalSearch(n.value,{renderOptions:{map:n.value,panel:null},onSearchComplete:t=>{S(t)}}),s.selectable&&n.value.addEventListener("click",t=>{const a=t.point;p(a),new BMap.Geocoder().getLocation(a,o=>{if(o){const i={title:o.address,address:o.address,point:{lng:a.lng,lat:a.lat}};w("select-address",i)}})})}catch(e){console.error("加载百度地图失败",e),f.error("加载地图失败，请刷新页面重试")}},h=()=>{if(!d.value){f.warning("请输入搜索关键词");return}l.value=[],y.search(d.value)},S=e=>{if(!e){l.value=[],f.info("未找到相关地点");return}l.value=[];try{if(e.getCurrentNumPois&&e.getCurrentNumPois()>0)for(let t=0;t<e.getCurrentNumPois();t++){const a=e.getPoi(t);a&&l.value.push({title:a.title,address:a.address,point:{lng:a.point.lng,lat:a.point.lat}})}else if(e.getNumPois&&e.getNumPois()>0)e.getPois().forEach(a=>{l.value.push({title:a.title,address:a.address,point:{lng:a.point.lng,lat:a.point.lat}})});else for(let t=0;t<e.getNumResults();t++)if(e.getPoi(t)){const a=e.getPoi(t);l.value.push({title:a.title||a.name,address:a.address,point:{lng:a.point.lng,lat:a.point.lat}})}}catch(t){console.error("解析搜索结果时出错:",t)}if(l.value.length===0)try{for(let t=0;t<e.getNumResults();t++){const a=e.getResults()[t];if(a&&a.getPoi){const r=a.getNumPois();for(let o=0;o<r;o++){const i=a.getPoi(o);l.value.push({title:i.title||i.name,address:i.address,point:{lng:i.point.lng,lat:i.point.lat}})}}}}catch(t){console.error("尝试备用方法解析搜索结果时出错:",t)}l.value.length===0&&f.info("未找到相关地点或结果解析失败")},W=e=>{const t=new BMap.Point(e.point.lng,e.point.lat);n.value.centerAndZoom(t,18),p(t,e.title),l.value=[],w("select-address",e)},p=(e,t)=>{if(c&&n.value.removeOverlay(c),c=new BMap.Marker(e),n.value.addOverlay(c),t){const a=new BMap.InfoWindow(t);c.addEventListener("click",()=>{c.openInfoWindow(a)})}n.value.panTo(e)};return b({setCenter:(e,t,a=18)=>{if(n.value){const r=new BMap.Point(e,t);n.value.centerAndZoom(r,a),p(r)}},search:e=>{d.value=e,h()}}),A(()=>s.defaultMarker,e=>{if(e&&n.value){const t=new BMap.Point(e.lng,e.lat);p(t,e.title)}},{deep:!0}),L(()=>{O(()=>{E()})}),(e,t)=>{const a=V,r=D;return u(),m("div",T,[M("div",{id:"map-container",ref_key:"mapContainer",ref:B,style:Z({height:g.height+"px"})},null,4),g.showSearch?(u(),m("div",F,[k(r,{modelValue:d.value,"onUpdate:modelValue":t[0]||(t[0]=o=>d.value=o),placeholder:"请输入地址",clearable:"",onKeyup:I(h,["enter"])},{append:_(()=>[k(a,{onClick:h},{default:_(()=>t[1]||(t[1]=[z("搜索")])),_:1})]),_:1},8,["modelValue"]),l.value.length>0?(u(),m("div",U,[(u(!0),m(K,null,R(l.value,(o,i)=>(u(),m("div",{key:i,class:"search-result-item",onClick:X=>W(o)},[M("span",null,C(o.title),1),M("span",G,C(o.address),1)],8,$))),128))])):P("",!0)])):P("",!0)])}}},Y=j(H,[["__scopeId","data-v-50ce6ab3"]]);export{Y as B};
