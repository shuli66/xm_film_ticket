import{r as ee,c as V,a as x,b as e,w as o,j as d,E as g,J as B,K as le,B as te,L as ae,M as oe,N as re,O as ne,o as n,h as s,i,t as u,F as D,z as E,u as S,P as se,Q as ie,I as ue,R as de,ad as me,G as pe,ae as fe,S as ce,ag as _e,af as ge,T as be,ah as ye,ai as we,U as Ve,aj as ve,aa as ke,V as xe}from"./index-CwlnEuFy.js";/* empty css               *//* empty css                *//* empty css                  *//* empty css                    *//* empty css                     *//* empty css                 *//* empty css              *//* empty css                     *//* empty css                    *//* empty css                  *//* empty css               *//* empty css               *//* empty css                   *//* empty css            *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                *//* empty css                          *//* empty css             *//* empty css                     *//* empty css                */import{r as k}from"./request--KQcSzqU.js";/* empty css                    */const he={class:"card",style:{"margin-bottom":"5px"}},De={key:0,class:"card",style:{"margin-bottom":"5px"}},Ee={class:"card",style:{"margin-bottom":"5px"}},Ue={style:{width:"100px"},class:"line1"},Ie={style:{width:"100px"},class:"line1"},Ne={key:1,class:"card"},Se={key:0,class:"status-info"},Ce={class:"dialog-footer"},ol={__name:"Film",setup(Ae){const z="http://8.130.169.157",a=ee({user:JSON.parse(localStorage.getItem("xm-user")||"{}"),formVisible:!1,form:{},tableData:[],pageNum:1,pageSize:8,total:0,title:null,status:null,ids:[],typeData:[],areaData:[]}),U=()=>{k.get("/type/selectAll").then(r=>{r.code==="200"?a.typeData=r.data:g.error(r.msg)})},I=()=>{k.get("/area/selectAll").then(r=>{r.code==="200"?a.areaData=r.data:g.error(r.msg)})},y=()=>{k.get("/film/selectPage",{params:{pageNum:a.pageNum,pageSize:a.pageSize,title:a.title,status:a.status}}).then(r=>{var t,p;r.code==="200"?(a.tableData=((t=r.data)==null?void 0:t.list)||[],a.total=(p=r.data)==null?void 0:p.total):g.error(r.msg)})},F=()=>{a.form={time:90,ids:[]},a.formVisible=!0,U(),I()},O=r=>{a.form=JSON.parse(JSON.stringify(r)),a.formVisible=!0,U(),I()},P=()=>{let r={...a.form};r.id||(r.status=null),r.id?k.put("/film/update",r).then(t=>{t.code==="200"?(g.success("操作成功"),a.formVisible=!1,y()):g.error(t.msg)}):k.post("/film/add",r).then(t=>{t.code==="200"?(g.success("操作成功"),a.formVisible=!1,y()):g.error(t.msg)})},T=r=>{B.confirm("删除后数据无法恢复，您确定删除吗？","删除确认",{type:"warning"}).then(t=>{k.delete("/film/delete/"+r).then(p=>{p.code==="200"?(g.success("删除成功"),y()):g.error(p.msg)})}).catch(t=>{console.error(t)})},J=()=>{if(!a.ids.length){g.warning("请选择数据");return}B.confirm("删除后数据无法恢复，您确定删除吗？","删除确认",{type:"warning"}).then(r=>{k.delete("/film/delete/batch",{data:a.ids}).then(t=>{t.code==="200"?(g.success("操作成功"),y()):g.error(t.msg)})}).catch(r=>{console.error(r)})},R=r=>{a.ids=r.map(t=>t.id)},X=r=>{a.form.img=r.data},Y=()=>{a.title=null,a.status=null,y()},C=r=>{if(a.form.status==="停止上映")return!1;const t=new Date().toISOString().slice(0,10),p=a.form.start;return r==="待上映"?p>t:r==="已上映"?p<=t:!0};return y(),U(),I(),(r,t)=>{const p=le,m=ue,h=te,b=ae,f=de,c=me,w=pe,A=fe,M=ce,$=_e,j=ge,G=oe,L=re,_=be,q=ye,K=we,Q=Ve,N=ve,H=ke,W=xe,Z=ne;return n(),V("div",null,[x("div",he,[e(p,{modelValue:a.title,"onUpdate:modelValue":t[0]||(t[0]=l=>a.title=l),"prefix-icon":"Search",style:{width:"240px","margin-right":"10px"},placeholder:"请输入电影名称查询"},null,8,["modelValue"]),e(h,{modelValue:a.status,"onUpdate:modelValue":t[1]||(t[1]=l=>a.status=l),placeholder:"请选择电影状态",style:{width:"240px","margin-right":"10px"}},{default:o(()=>[e(m,{label:"待上映",value:"待上映"}),e(m,{label:"已上映",value:"已上映"}),e(m,{label:"停止上映",value:"停止上映"})]),_:1},8,["modelValue"]),e(b,{type:"info",plain:"",onClick:y},{default:o(()=>t[16]||(t[16]=[s("查询")])),_:1}),e(b,{type:"warning",plain:"",style:{margin:"0 10px"},onClick:Y},{default:o(()=>t[17]||(t[17]=[s("重置")])),_:1})]),a.user.role==="ADMIN"?(n(),V("div",De,[e(b,{type:"primary",plain:"",onClick:F},{default:o(()=>t[18]||(t[18]=[s("新增")])),_:1}),e(b,{type:"danger",plain:"",onClick:J},{default:o(()=>t[19]||(t[19]=[s("批量删除")])),_:1})])):d("",!0),x("div",Ee,[e(G,{"tooltip-effect":"dark widthStyle",stripe:"",data:a.tableData,onSelectionChange:R},{default:o(()=>[a.user.role==="ADMIN"?(n(),i(f,{key:0,type:"selection",width:"55"})):d("",!0),e(f,{type:"expand"},{default:o(l=>[e(j,{class:"margin-top",title:"电影信息",column:5,border:""},{default:o(()=>[e(c,{label:"电影名称"},{default:o(()=>[s(u(l.row.title),1)]),_:2},1024),e(c,{label:"英文名称"},{default:o(()=>[s(u(l.row.english),1)]),_:2},1024),e(c,{label:"上映日期"},{default:o(()=>[s(u(l.row.start),1)]),_:2},1024),e(c,{label:"电影时长"},{default:o(()=>[s(u(l.row.time)+" 分钟",1)]),_:2},1024),e(c,{label:"电影类型"},{default:o(()=>[(n(!0),V(D,null,E(l.row.types,v=>(n(),i(w,{type:"info",style:{"margin-right":"5px"}},{default:o(()=>[s(u(v),1)]),_:2},1024))),256))]),_:2},1024),e(c,{label:"电影语言"},{default:o(()=>[s(u(l.row.language),1)]),_:2},1024),e(c,{label:"电影分辨率"},{default:o(()=>[s(u(l.row.resolution),1)]),_:2},1024),e(c,{label:"电影简介"},{default:o(()=>[e(A,{placement:"top-start",title:"电影简介",width:400,trigger:"hover",content:l.row.content},{reference:o(()=>[x("div",Ue,u(l.row.content),1)]),_:2},1032,["content"])]),_:2},1024),e(c,{label:"电影封面"},{default:o(()=>[l.row.img?(n(),i(M,{key:0,style:{width:"40px",height:"40px",display:"block"},src:l.row.img,"preview-src-list":[l.row.img],"preview-teleported":""},null,8,["src","preview-src-list"])):d("",!0)]),_:2},1024),e(c,{label:"制作公司"},{default:o(()=>[e(A,{placement:"top-start",title:"制作公司",width:200,trigger:"hover",content:l.row.employ},{reference:o(()=>[x("div",Ie,u(l.row.employ),1)]),_:2},1032,["content"])]),_:2},1024),e(c,{label:"电影区域"},{default:o(()=>[s(u(l.row.areaName),1)]),_:2},1024),e(c,{label:"电影状态"},{default:o(()=>[l.row.status==="待上映"?(n(),i(w,{key:0,type:"warning"},{default:o(()=>[s(u(l.row.status),1)]),_:2},1024)):d("",!0),l.row.status==="已上映"?(n(),i(w,{key:1,type:"success"},{default:o(()=>[s(u(l.row.status),1)]),_:2},1024)):d("",!0),l.row.status==="停止上映"?(n(),i(w,{key:2,type:"danger"},{default:o(()=>[s(u(l.row.status),1)]),_:2},1024)):d("",!0)]),_:2},1024),e(c,{label:"电影评分"},{default:o(()=>[e($,{modelValue:l.row.score,"onUpdate:modelValue":v=>l.row.score=v,disabled:"",max:10,"text-color":"#ff9900"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)]),_:1}),e(f,{prop:"img",label:"电影封面"},{default:o(l=>[l.row.img?(n(),i(M,{key:0,style:{width:"40px",height:"40px","border-radius":"5px",display:"block"},src:l.row.img,"preview-src-list":[l.row.img],"preview-teleported":""},null,8,["src","preview-src-list"])):d("",!0)]),_:1}),e(f,{prop:"title",label:"电影名称"}),e(f,{prop:"english",label:"英文名","show-overflow-tooltip":""}),e(f,{prop:"start",label:"上映日期"}),e(f,{prop:"time",label:"电影时长/分"}),e(f,{prop:"types",label:"电影类型",width:"180"},{default:o(l=>[(n(!0),V(D,null,E(l.row.types,v=>(n(),i(w,{type:"info",style:{"margin-right":"5px"}},{default:o(()=>[s(u(v),1)]),_:2},1024))),256))]),_:1}),e(f,{prop:"language",label:"语言"}),e(f,{prop:"content",label:"电影简介","show-overflow-tooltip":""}),e(f,{prop:"areaName",label:"电影区域"}),e(f,{prop:"status",label:"电影状态"},{default:o(l=>[l.row.status==="待上映"?(n(),i(w,{key:0,type:"warning"},{default:o(()=>[s(u(l.row.status),1)]),_:2},1024)):d("",!0),l.row.status==="已上映"?(n(),i(w,{key:1,type:"success"},{default:o(()=>[s(u(l.row.status),1)]),_:2},1024)):d("",!0),l.row.status==="停止上映"?(n(),i(w,{key:2,type:"danger"},{default:o(()=>[s(u(l.row.status),1)]),_:2},1024)):d("",!0)]),_:1}),a.user.role==="ADMIN"?(n(),i(f,{key:1,label:"操作",width:"100",fixed:"right"},{default:o(l=>[e(b,{type:"primary",circle:"",icon:S(se),onClick:v=>O(l.row)},null,8,["icon","onClick"]),e(b,{type:"danger",circle:"",icon:S(ie),onClick:v=>T(l.row.id)},null,8,["icon","onClick"])]),_:1})):d("",!0)]),_:1},8,["data"])]),a.total?(n(),V("div",Ne,[e(L,{onCurrentChange:y,background:"",layout:"prev, pager, next","page-size":a.pageSize,"current-page":a.pageNum,"onUpdate:currentPage":t[2]||(t[2]=l=>a.pageNum=l),total:a.total},null,8,["page-size","current-page","total"])])):d("",!0),e(Z,{title:"电影信息",modelValue:a.formVisible,"onUpdate:modelValue":t[15]||(t[15]=l=>a.formVisible=l),width:"50%","destroy-on-close":""},{footer:o(()=>[x("span",Ce,[e(b,{onClick:t[14]||(t[14]=l=>a.formVisible=!1)},{default:o(()=>t[22]||(t[22]=[s("取 消")])),_:1}),e(b,{type:"primary",onClick:P},{default:o(()=>t[23]||(t[23]=[s("确 定")])),_:1})])]),default:o(()=>[e(W,{ref:"form",model:a.form,"label-width":"85px",style:{padding:"20px"}},{default:o(()=>[e(_,{prop:"title",label:"电影名称"},{default:o(()=>[e(p,{modelValue:a.form.title,"onUpdate:modelValue":t[3]||(t[3]=l=>a.form.title=l),placeholder:"请输入电影名称"},null,8,["modelValue"])]),_:1}),e(_,{prop:"english",label:"英文名称"},{default:o(()=>[e(p,{modelValue:a.form.english,"onUpdate:modelValue":t[4]||(t[4]=l=>a.form.english=l),placeholder:"请输入英文名称"},null,8,["modelValue"])]),_:1}),e(_,{prop:"start",label:"上映日期"},{default:o(()=>[e(q,{modelValue:a.form.start,"onUpdate:modelValue":t[5]||(t[5]=l=>a.form.start=l),type:"date","value-format":"YYYY-MM-DD",style:{width:"250px"}},null,8,["modelValue"])]),_:1}),e(_,{prop:"time",label:"电影时长"},{default:o(()=>[e(K,{modelValue:a.form.time,"onUpdate:modelValue":t[6]||(t[6]=l=>a.form.time=l),min:30,style:{width:"250px"}},null,8,["modelValue"])]),_:1}),e(_,{prop:"typeId",label:"电影类型"},{default:o(()=>[e(h,{modelValue:a.form.ids,"onUpdate:modelValue":t[7]||(t[7]=l=>a.form.ids=l),multiple:"","multiple-limit":"3",placeholder:"请选择电影分类"},{default:o(()=>[(n(!0),V(D,null,E(a.typeData,l=>(n(),i(m,{key:l.id,label:l.title,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(_,{prop:"language",label:"电影语言"},{default:o(()=>[e(h,{modelValue:a.form.language,"onUpdate:modelValue":t[8]||(t[8]=l=>a.form.language=l),placeholder:"请选择电影语言"},{default:o(()=>[e(m,{label:"普通话",value:"普通话"}),e(m,{label:"港语",value:"港语"}),e(m,{label:"英语",value:"英语"}),e(m,{label:"法语",value:"法语"}),e(m,{label:"俄语",value:"俄语"}),e(m,{label:"日语",value:"日语"}),e(m,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),e(_,{prop:"resolution",label:"分辨率"},{default:o(()=>[e(h,{modelValue:a.form.resolution,"onUpdate:modelValue":t[9]||(t[9]=l=>a.form.resolution=l),placeholder:"请选择分辨率"},{default:o(()=>[e(m,{label:"普通",value:"普通"}),e(m,{label:"2DIMAX",value:"2DIMAX"}),e(m,{label:"3DIMAX",value:"3DIMAX"})]),_:1},8,["modelValue"])]),_:1}),e(_,{prop:"content",label:"电影简介"},{default:o(()=>[e(p,{type:"textarea",rows:5,modelValue:a.form.content,"onUpdate:modelValue":t[10]||(t[10]=l=>a.form.content=l),placeholder:"请输入电影简介"},null,8,["modelValue"])]),_:1}),e(_,{prop:"img",label:"电影封面"},{default:o(()=>[e(Q,{action:S(z)+"/files/upload","on-success":X,"list-type":"picture"},{default:o(()=>[e(b,{type:"primary"},{default:o(()=>t[20]||(t[20]=[s("点击上传电影封面图")])),_:1})]),_:1},8,["action"])]),_:1}),e(_,{prop:"employ",label:"制作公司"},{default:o(()=>[e(p,{modelValue:a.form.employ,"onUpdate:modelValue":t[11]||(t[11]=l=>a.form.employ=l),placeholder:"请输入制作公司"},null,8,["modelValue"])]),_:1}),e(_,{prop:"areaId",label:"电影区域"},{default:o(()=>[e(h,{modelValue:a.form.areaId,"onUpdate:modelValue":t[12]||(t[12]=l=>a.form.areaId=l),placeholder:"请选择电影区域"},{default:o(()=>[(n(!0),V(D,null,E(a.areaData,l=>(n(),i(m,{key:l.id,label:l.title,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a.form.id?(n(),i(_,{key:0,prop:"status",label:"电影状态"},{default:o(()=>[e(H,{modelValue:a.form.status,"onUpdate:modelValue":t[13]||(t[13]=l=>a.form.status=l)},{default:o(()=>[C("待上映")?(n(),i(N,{key:0,label:"待上映",value:"待上映"})):d("",!0),C("已上映")?(n(),i(N,{key:1,label:"已上映",value:"已上映"})):d("",!0),e(N,{label:"停止上映",value:"停止上映"})]),_:1},8,["modelValue"]),a.form.status!=="停止上映"?(n(),V("div",Se,t[21]||(t[21]=[x("small",null,"（当前状态由上映日期自动判断，仅可手动选择停止上映）",-1)]))):d("",!0)]),_:1})):d("",!0)]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}};export{ol as default};
