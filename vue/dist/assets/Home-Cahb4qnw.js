import{_ as $,v as N,r as j,x as H,y as G,c as p,a as t,t as l,j as w,b as h,w as C,h as b,F as R,z as x,E as A,A as W,B as q,o as d,i as J,C as U,D as Y,G as K,H as Q,I as X}from"./index-CwlnEuFy.js";/* empty css            *//* empty css               *//* empty css                  *//* empty css               *//* empty css                      */import{r as y}from"./request--KQcSzqU.js";import{i as z,L as Z}from"./index-CrL2ELlk.js";const tt={class:"container"},et={class:"welcome-card"},st={class:"welcome-message"},at={key:0,class:"welcome-stats"},nt={class:"stat-item"},ot={class:"stat-number"},it={class:"stat-item"},lt={class:"stat-number"},rt={class:"stat-item"},ct={class:"stat-number"},dt={class:"stat-item"},mt={class:"stat-number"},ut={class:"content-wrapper"},pt={class:"announcement-section"},ft={class:"announcement-header"},_t={class:"announcement-count"},ht={class:"announcement-box"},gt={class:"announcement-content"},vt={class:"announcement-footer"},Ct={class:"announcement-time"},bt={key:0,class:"visualization-section"},yt={class:"dashboard-header"},St={class:"chart-container"},kt={class:"chart-container"},Et={class:"ranking-list"},wt={class:"ranking-info"},At={class:"ranking-title"},It={class:"ranking-progress"},Dt={class:"ranking-value"},Nt={key:0,class:"empty-data"},Rt={class:"chart-container"},xt={__name:"Home",setup(zt){const S=N(null),k=N(null);let g=null,v=null;const s=j({user:JSON.parse(localStorage.getItem("xm-user")||"{}"),noticeData:[],timeRange:"7",baseStats:{todayPrice:0,totalPrice:0},orderStats:{orderCount:0,pendingCount:0},lineChartData:{xAxis:[],yAxis:[]},pieChartData:[],filmRanking:[]}),E=a=>a.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g,","),L=()=>{y.get("/notice/selectAll").then(a=>{a.code==="200"?s.noticeData=a.data:A.error(a.msg)})},M=a=>{if(!a)return"";const e=new Date(a);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`},B=a=>{const e=["primary","success","warning","danger","info"];return e[a%e.length]},F=a=>{const e=["#409EFF","#67C23A","#E6A23C","#F56C6C","#909399"];return e[a%e.length]},O=()=>{var e;if(((e=s.user)==null?void 0:e.role)!=="CINEMA")return;const a=s.user.id;y.get("/statistics/cinemaBase",{params:{cinemaId:a}}).then(o=>{o.code==="200"?s.baseStats=o.data:A.error(o.msg)})},V=()=>{var e;if(((e=s.user)==null?void 0:e.role)!=="CINEMA")return;const a=s.user.id;y.get("/orders/selectAll",{params:{cinemaId:a}}).then(o=>{if(o.code==="200"){const f=o.data||[];s.orderStats.orderCount=f.length,s.orderStats.pendingCount=f.filter(n=>n.status==="待取票").length;const _={};f.forEach(n=>{n.status!=="已退票"&&(n.status==="已取票"||n.status==="待取票")&&(_[n.filmId]||(_[n.filmId]={filmId:n.filmId,filmName:n.filmName,sales:0}),_[n.filmId].sales+=n.price)});const c=Object.values(_).sort((n,u)=>u.sales-n.sales).slice(0,5);if(c.length>0){const n=c[0].sales;c.forEach(u=>{u.percentage=u.sales/n*100})}s.filmRanking=c;const m={};f.forEach(n=>{m[n.status]||(m[n.status]=0),m[n.status]++}),s.pieChartData=Object.keys(m).map(n=>({name:n,value:m[n]})),T()}})},I=()=>{var e;if(((e=s.user)==null?void 0:e.role)!=="CINEMA")return;const a=s.user.id;y.get("/statistics/cinemaLine",{params:{cinemaId:a}}).then(o=>{o.code==="200"?(s.lineChartData=o.data,P()):A.error(o.msg)})},P=()=>{if(!S.value)return;g||(g=z(S.value));const a={tooltip:{trigger:"axis",formatter:"{b}<br/>{a}: {c} 元"},xAxis:{type:"category",data:s.lineChartData.xAxis||[],axisLabel:{rotate:45}},yAxis:{type:"value",name:"金额 (元)"},series:[{name:"票房",type:"line",data:s.lineChartData.yAxis||[],smooth:!0,symbol:"circle",symbolSize:8,itemStyle:{color:"#3f87e8"},lineStyle:{width:3},areaStyle:{color:new Z(0,0,0,1,[{offset:0,color:"rgba(63, 135, 232, 0.5)"},{offset:1,color:"rgba(63, 135, 232, 0.05)"}])}}],grid:{left:"3%",right:"4%",bottom:"15%",top:"15%",containLabel:!0}};g.setOption(a)},T=()=>{if(!k.value)return;v||(v=z(k.value));const a=["#3f87e8","#67C23A","#E6A23C","#F56C6C","#909399"],e={tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"horizontal",bottom:"0",data:s.pieChartData.map(o=>o.name)},series:[{type:"pie",radius:["40%","70%"],center:["50%","45%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"16",fontWeight:"bold"}},labelLine:{show:!1},data:s.pieChartData,color:a}]};v.setOption(e)};return H(()=>s.timeRange,()=>{I()}),G(()=>{var a;L(),((a=s.user)==null?void 0:a.role)==="CINEMA"&&(O(),V(),I(),window.addEventListener("resize",()=>{g&&g.resize(),v&&v.resize()}))}),(a,e)=>{var n,u,D;const o=K,f=Q,_=W,c=X,m=q;return d(),p("div",tt,[t("div",et,[t("div",st,[t("h1",null,"您好，"+l((n=s.user)==null?void 0:n.name)+"！",1),e[1]||(e[1]=t("p",null,"欢迎使用本系统！",-1))]),((u=s.user)==null?void 0:u.role)==="CINEMA"?(d(),p("div",at,[t("div",nt,[t("div",ot,l(E(s.baseStats.todayPrice||0)),1),e[2]||(e[2]=t("div",{class:"stat-label"},"今日票房(元)",-1))]),t("div",it,[t("div",lt,l(E(s.baseStats.totalPrice||0)),1),e[3]||(e[3]=t("div",{class:"stat-label"},"累计票房(元)",-1))]),t("div",rt,[t("div",ct,l(s.orderStats.orderCount||0),1),e[4]||(e[4]=t("div",{class:"stat-label"},"累计订单数",-1))]),t("div",dt,[t("div",mt,l(s.orderStats.pendingCount||0),1),e[5]||(e[5]=t("div",{class:"stat-label"},"待取票",-1))])])):w("",!0)]),t("div",ut,[t("div",pt,[t("div",ft,[e[6]||(e[6]=t("h2",null,"系统公告",-1)),t("span",_t,l(s.noticeData.length)+"条公告",1)]),h(_,{class:"timeline"},{default:C(()=>[(d(!0),p(R,null,x(s.noticeData,(r,i)=>(d(),J(f,{key:i,timestamp:r.time,type:B(i),color:F(i),class:"announcement-item"},{default:C(()=>[t("div",ht,[t("div",gt,l(r.content),1),t("div",vt,[t("span",Ct,l(M(r.time)),1),h(o,{size:"small",type:i%4===0?"danger":i%3===0?"warning":i%2===0?"success":"info",effect:"dark"},{default:C(()=>[b(l(i%4===0?"重要":i%3===0?"系统":i%2===0?"功能":"常规"),1)]),_:2},1032,["type"])])])]),_:2},1032,["timestamp","type","color"]))),128))]),_:1})]),((D=s.user)==null?void 0:D.role)==="CINEMA"?(d(),p("div",bt,[t("div",yt,[e[7]||(e[7]=t("h2",null,"票务数据分析",-1)),h(m,{modelValue:s.timeRange,"onUpdate:modelValue":e[0]||(e[0]=r=>s.timeRange=r),placeholder:"选择时间范围",size:"small"},{default:C(()=>[h(c,{label:"最近7天",value:"7"}),h(c,{label:"最近30天",value:"30"}),h(c,{label:"最近90天",value:"90"})]),_:1},8,["modelValue"])]),t("div",St,[e[8]||(e[8]=t("div",{class:"chart-title"},[t("i",{class:"el-icon-data-line"}),b(" 票房趋势 ")],-1)),t("div",{class:"chart-wrapper",ref_key:"lineChartRef",ref:S},null,512)]),t("div",kt,[e[9]||(e[9]=t("div",{class:"chart-title"},[t("i",{class:"el-icon-film"}),b(" 热门电影排行 ")],-1)),t("div",Et,[(d(!0),p(R,null,x(s.filmRanking,(r,i)=>(d(),p("div",{key:i,class:"ranking-item"},[t("div",{class:U(["ranking-index",`rank-${i+1}`])},l(i+1),3),t("div",wt,[t("div",At,l(r.filmName),1),t("div",It,[t("div",{class:"progress-bar",style:Y({width:`${r.percentage}%`})},null,4)])]),t("div",Dt,l(E(r.sales)),1)]))),128)),s.filmRanking.length?w("",!0):(d(),p("div",Nt," 暂无电影销售数据 "))])]),t("div",Rt,[e[10]||(e[10]=t("div",{class:"chart-title"},[t("i",{class:"el-icon-pie-chart"}),b(" 订单状态分布 ")],-1)),t("div",{class:"chart-wrapper",ref_key:"pieChartRef",ref:k},null,512)])])):w("",!0)])])}}},$t=$(xt,[["__scopeId","data-v-3da80dd5"]]);export{$t as default};
