import{_ as W,r as Z,d as T,c as r,a as t,t as a,F as p,z as v,b as i,w as n,C as E,i as u,j as $,E as d,m as tt,L as st,ag as et,X as ot,ae as lt,at,K as it,O as nt,o as c,au as N,h,a7 as ct,l as y,T as dt,V as rt}from"./index-CwlnEuFy.js";/* empty css                  *//* empty css               *//* empty css                *//* empty css              *//* empty css               *//* empty css               *//* empty css                *//* empty css            *//* empty css             *//* empty css               */import{r as _}from"./request--KQcSzqU.js";const mt={class:"film-detail-wrapper"},_t={class:"film-header"},ft={class:"film-header-content"},ut={class:"film-poster"},pt=["src","alt"],vt={class:"film-info"},gt={class:"film-title"},ht={class:"film-subtitle"},bt={class:"film-meta"},yt={class:"film-types"},Dt={class:"film-details"},Ct={class:"film-actions"},kt={class:"action-group"},It={class:"film-stats"},Vt={class:"stat-item"},xt={class:"stat-content"},St={class:"score-display"},Ft={class:"score-value"},wt={class:"score-details"},Tt={class:"score-count"},Et={class:"stat-item"},$t={class:"stat-content"},Nt={class:"box-office"},Pt={class:"box-office-value"},Rt={class:"film-content"},At={class:"main-content"},zt={class:"content-section"},Ut={class:"section-content"},Bt={class:"content-section"},Ot={key:0,class:"actor-section"},qt={class:"actor-role"},Jt=["src","alt"],Mt={class:"actor-name"},Lt={class:"actor-role"},jt=["src","alt"],Ht={class:"actor-name"},Kt={class:"actor-role"},Xt=["src","alt"],Yt={class:"actor-name"},Gt={class:"actor-role"},Qt=["src","alt"],Wt={class:"actor-name"},Zt={key:1,class:"empty-state"},ts={class:"content-section"},ss={class:"info-grid"},es={class:"info-item"},os={class:"info-content"},ls={class:"info-text line1"},as={class:"info-item"},is={class:"info-content"},ns={class:"info-text"},cs={class:"content-section"},ds={class:"box-office-grid"},rs={class:"box-office-item"},ms={class:"box-office-value"},_s={class:"box-office-item"},fs={class:"box-office-value"},us={class:"box-office-item"},ps={class:"box-office-value"},vs={class:"sidebar"},gs={class:"sidebar-section"},hs={key:0,class:"trailer-list"},bs=["onClick"],ys={class:"trailer-thumbnail"},Ds=["src","alt"],Cs={class:"play-icon"},ks={class:"trailer-info"},Is={class:"trailer-title line2"},Vs={class:"trailer-time"},xs={key:1,class:"empty-state"},Ss={class:"sidebar-section"},Fs={class:"section-title"},ws={key:0,class:"comment-count"},Ts={class:"comment-form"},Es={class:"comment-form-header"},$s={class:"comment-form-info"},Ns={class:"comment-form-username"},Ps={class:"comment-form-footer"},Rs={class:"comments-section"},As={key:0,class:"comments-list"},zs={class:"comment-header"},Us=["src","alt"],Bs={class:"comment-user"},Os={class:"user-name"},qs={class:"comment-time"},Js={key:0,class:"comment-actions"},Ms={class:"comment-content"},Ls={class:"comment-footer"},js={key:1,class:"empty-state"},Hs={class:"video-content"},Ks={class:"video-title"},Xs={class:"video-name"},Ys=["src"],Gs={class:"dialog-footer"},Qs={__name:"FilmDetail",setup(Ws){const P=l=>{if(!l)return"暂无时间";const e=new Date(l),m=e.getFullYear(),f=String(e.getMonth()+1).padStart(2,"0"),b=String(e.getDate()).padStart(2,"0"),g=String(e.getHours()).padStart(2,"0"),C=String(e.getMinutes()).padStart(2,"0");return`${m}-${f}-${b} ${g}:${C}`},s=Z({user:JSON.parse(localStorage.getItem("xm-user")||"{}"),filmId:T.currentRoute.value.query.id,filmData:{},videoData:[],form:{},formVisible:!1,actorData:[],collectFlag:!1,score:10,scoreVisible:!1,scoreFlag:!1,scoreTime:0,halfScore:0,todayPrice:0,priceRanking:0,commentVisible:!1,commentData:[],newComment:"",isCommenting:!1}),D=()=>{_.get("/comment/selectComments",{params:{filmId:s.filmId,commentText:s.commentText,pageNum:s.pageNum,pageSize:s.pageSize}}).then(l=>{console.log("评论数据",l.data),l.code==="200"?s.commentData=l.data.list:d.error(l.msg)}).catch(l=>{d.error("加载评论失败"),console.error(l)})},R=l=>{const e=s.user.id;_.delete(`/comment/deleteComment/${l}`,{params:{commentId:l,userId:e}}).then(m=>{m.code==="200"?(d.success("评论删除成功"),D()):d.error(m.msg)}).catch(m=>{d.error("删除评论失败"),console.error(m)})},A=()=>{if(!s.newComment.trim()){d.warning("评论内容不能为空");return}s.isCommenting=!0;const l=new Date().toISOString();_.post("comment/addComment",{filmId:s.filmId,userId:s.user.id,commentText:s.newComment,createTime:l}).then(e=>{e.code==="200"?(d.success("评论提交成功"),s.newComment="",D()):d.error(e.msg)}).catch(e=>{d.error("提交评论失败"),console.error(e)}).finally(()=>{s.isCommenting=!1})};D(),(()=>{_.get("/orders/selectTodayPrice/"+s.filmId).then(l=>{l.code==="200"?s.todayPrice=l.data:d.error(l.msg)})})(),(()=>{_.get("/film/selectPriceRanking/"+s.filmId).then(l=>{l.code==="200"?s.priceRanking=l.data:d.error(l.msg)})})();const z=()=>{s.scoreVisible=!0},U=()=>{let l={filmId:s.filmId,score:s.score};_.post("/score/add",l).then(e=>{e.code==="200"?(d.success("评分成功"),s.scoreVisible=!1,x(),k(),I()):d.error(e.msg)})},k=()=>{_.get("/score/selectAll",{params:{filmId:s.filmId,userId:s.user.id}}).then(l=>{l.code==="200"&&(s.scoreFlag=l.data.length)})},I=()=>{_.get("/score/selectAll",{params:{filmId:s.filmId}}).then(l=>{l.code==="200"&&(s.scoreTime=l.data.length)})};k(),I();const V=()=>{_.get("/collect/selectAll",{params:{userId:s.user.id,filmId:s.filmId}}).then(l=>{l.code==="200"?s.collectFlag=l.data.length:d.error(l.msg)})},B=()=>{d({message:`该影片将于 ${s.filmData.start} 上映，敬请期待！`,type:"info",duration:3e3,showClose:!0,center:!0})},O=()=>{let l={userId:s.user.id,filmId:s.filmId};_.post("/collect/add",l).then(e=>{e.code==="200"?(d.success("操作成功"),V()):d.error(e.msg)})},x=()=>{s.filmId=T.currentRoute.value.query.id,_.get("/film/selectById/"+s.filmId).then(l=>{l.code==="200"?(s.filmData=l.data,s.halfScore=(s.filmData.score/2).toFixed(1)):d.error(l.msg)})},q=()=>{_.get("/video/selectAll",{params:{filmId:s.filmId}}).then(l=>{l.code==="200"?s.videoData=l.data:d.error(l.msg)})},J=()=>{_.get("/actor/selectAll",{params:{filmId:s.filmId}}).then(l=>{l.code==="200"?s.actorData=l.data:d.error(l.msg)})},M=l=>{s.form=JSON.parse(JSON.stringify(l)),s.formVisible=!0};return x(),q(),J(),V(),(l,e)=>{const m=tt,f=st,b=et,g=ct,C=ot,L=y("VideoCamera"),j=lt,S=y("VideoPlay"),H=at,K=it,X=y("DeleteFilled"),Y=y("ThumbsUp"),F=nt,G=dt,Q=rt;return c(),r("div",mt,[t("div",_t,[t("div",ft,[t("div",ut,[t("img",{src:s.filmData.img,alt:s.filmData.title},null,8,pt)]),t("div",vt,[t("h1",gt,a(s.filmData.title),1),t("div",ht,a(s.filmData.english),1),t("div",bt,[t("div",yt,[(c(!0),r(p,null,v(s.filmData.types,o=>(c(),r("span",{key:o,class:"type-tag"},a(o),1))),128))]),t("div",Dt,[t("span",null,a(s.filmData.areaName),1),e[8]||(e[8]=t("span",{class:"separator"},"|",-1)),t("span",null,a(s.filmData.time)+"分钟",1),e[9]||(e[9]=t("span",{class:"separator"},"|",-1)),t("span",null,a(s.filmData.start)+" 中国大陆上映",1)])]),t("div",Ct,[t("div",kt,[i(f,{class:E({"action-btn":!0,active:s.collectFlag}),onClick:O},{default:n(()=>[i(m,{size:24},{default:n(()=>[(c(),u(N(s.collectFlag?"StarFilled":"Star")))]),_:1}),t("span",null,a(s.collectFlag?"已想看":"想看"),1)]),_:1},8,["class"]),i(f,{class:E({"action-btn":!0,active:s.scoreFlag}),onClick:e[0]||(e[0]=o=>s.filmData.status==="已上映"?z():null),disabled:s.filmData.status!=="已上映"},{default:n(()=>[i(m,{size:24},{default:n(()=>[(c(),u(N(s.scoreFlag?"Comment":"ChatDotSquare")))]),_:1}),t("span",null,a(s.scoreFlag?"已评分":"评分"),1)]),_:1},8,["class","disabled"])]),s.filmData.status==="已上映"?(c(),u(f,{key:0,class:"buy-ticket-btn",onClick:e[1]||(e[1]=o=>l.$router.push("/front/filmCinema?id="+s.filmData.id))},{default:n(()=>e[10]||(e[10]=[h(" 特惠购票 ")])),_:1})):s.filmData.status==="待上映"?(c(),u(f,{key:1,class:"coming-soon-btn",onClick:B},{default:n(()=>e[11]||(e[11]=[h(" 即将上映 ")])),_:1})):(c(),u(f,{key:2,class:"ended-btn",disabled:""},{default:n(()=>e[12]||(e[12]=[h(" 已下映 ")])),_:1}))])]),t("div",It,[t("div",Vt,[e[14]||(e[14]=t("div",{class:"stat-label"},"影片口碑",-1)),t("div",xt,[t("div",St,[t("span",Ft,a(s.filmData.score),1),e[13]||(e[13]=t("span",{class:"score-label"},"分",-1))]),t("div",wt,[i(b,{modelValue:s.halfScore,"onUpdate:modelValue":e[2]||(e[2]=o=>s.halfScore=o),disabled:""},null,8,["modelValue"]),t("div",Tt,a(s.scoreTime)+"人评分",1)])])]),t("div",Et,[e[16]||(e[16]=t("div",{class:"stat-label"},"累计票房",-1)),t("div",$t,[t("div",Nt,[t("span",Pt,a((s.filmData.total*1).toFixed(2)),1),e[15]||(e[15]=t("span",{class:"box-office-label"},"元",-1))])])])])])]),t("div",Rt,[t("div",At,[t("div",zt,[e[17]||(e[17]=t("h2",{class:"section-title"},"剧情简介",-1)),t("div",Ut,a(s.filmData.content),1)]),t("div",Bt,[e[18]||(e[18]=t("h2",{class:"section-title"},"演职人员",-1)),s.actorData&&s.actorData.length>0?(c(),r("div",Ot,[i(C,{gutter:10},{default:n(()=>[(c(!0),r(p,null,v(s.actorData.filter(o=>o.role==="导演"),o=>(c(),u(g,{span:5,key:o.id,class:"actor-item"},{default:n(()=>[t("div",qt,a(o.role),1),t("img",{src:o.avatar,alt:o.name,class:"actor-avatar"},null,8,Jt),t("div",Mt,a(o.name),1)]),_:2},1024))),128)),(c(!0),r(p,null,v(s.actorData.filter(o=>o.role==="编剧"),o=>(c(),u(g,{span:5,key:o.id,class:"actor-item"},{default:n(()=>[t("div",Lt,a(o.role),1),t("img",{src:o.avatar,alt:o.name,class:"actor-avatar"},null,8,jt),t("div",Ht,a(o.name),1)]),_:2},1024))),128)),(c(!0),r(p,null,v(s.actorData.filter(o=>o.role==="主演"),o=>(c(),u(g,{span:5,key:o.id,class:"actor-item"},{default:n(()=>[t("div",Kt,a(o.role),1),t("img",{src:o.avatar,alt:o.name,class:"actor-avatar"},null,8,Xt),t("div",Yt,a(o.name),1)]),_:2},1024))),128)),(c(!0),r(p,null,v(s.actorData.filter(o=>o.role==="演员"),o=>(c(),u(g,{span:5,key:o.id,class:"actor-item"},{default:n(()=>[t("div",Gt,a(o.role),1),t("img",{src:o.avatar,alt:o.name,class:"actor-avatar"},null,8,Qt),t("div",Wt,a(o.name),1)]),_:2},1024))),128))]),_:1})])):(c(),r("div",Zt,"管理员暂未录入演职人员信息"))]),t("div",ts,[e[21]||(e[21]=t("h2",{class:"section-title"},"出品信息",-1)),t("div",ss,[t("div",es,[i(m,{class:"info-icon"},{default:n(()=>[i(L)]),_:1}),t("div",os,[e[19]||(e[19]=t("div",{class:"info-title"},"出品发行",-1)),i(j,{placement:"top-start",title:"出品发行",width:220,trigger:"hover",content:s.filmData.employ},{reference:n(()=>[t("div",ls,a(s.filmData.employ),1)]),_:1},8,["content"])])]),t("div",as,[i(m,{class:"info-icon"},{default:n(()=>[i(S)]),_:1}),t("div",is,[e[20]||(e[20]=t("div",{class:"info-title"},"技术参考",-1)),t("div",ns,a(s.filmData.time)+" 分钟",1)])])])]),t("div",cs,[e[25]||(e[25]=t("h2",{class:"section-title"},"票房",-1)),t("div",ds,[t("div",rs,[t("div",ms,a(s.priceRanking),1),e[22]||(e[22]=t("div",{class:"box-office-label"},"票房排名",-1))]),t("div",_s,[t("div",fs,a((s.todayPrice*1).toFixed(2)),1),e[23]||(e[23]=t("div",{class:"box-office-label"},"今日票房（元）",-1))]),t("div",us,[t("div",ps,a((s.filmData.total*1).toFixed(2)),1),e[24]||(e[24]=t("div",{class:"box-office-label"},"总票房（元）",-1))])])])]),t("div",vs,[t("div",gs,[e[26]||(e[26]=t("h2",{class:"section-title"},"预告视频",-1)),s.videoData&&s.videoData.length>0?(c(),r("div",hs,[(c(!0),r(p,null,v(s.videoData,o=>(c(),r("div",{key:o.id,class:"trailer-item",onClick:w=>M(o)},[t("div",ys,[t("img",{src:o.img,alt:o.name},null,8,Ds),t("div",Cs,[i(m,null,{default:n(()=>[i(S)]),_:1})])]),t("div",ks,[t("div",Is,a(o.name),1),t("div",Vs,a(o.time),1)])],8,bs))),128))])):(c(),r("div",xs,"暂无预告片"))]),t("div",Ss,[t("h2",Fs,[e[27]||(e[27]=t("span",null,"用户评论",-1)),s.commentData.length>0?(c(),r("span",ws,"("+a(s.commentData.length)+")",1)):$("",!0)]),t("div",Ts,[t("div",Es,[i(H,{size:40,src:s.user.avatar||"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png"},null,8,["src"]),t("div",$s,[t("span",Ns,a(s.user.username||"游客"),1),e[28]||(e[28]=t("span",{class:"comment-form-tip"},"分享你的观影感受",-1))])]),i(K,{modelValue:s.newComment,"onUpdate:modelValue":e[3]||(e[3]=o=>s.newComment=o),type:"textarea",rows:3,placeholder:"说说你对这部电影的看法...",disabled:s.isCommenting},null,8,["modelValue","disabled"]),t("div",Ps,[e[29]||(e[29]=t("span",{class:"comment-tips"},"文明评论，理性发言",-1)),i(f,{type:"primary",loading:s.isCommenting,onClick:A,class:"submit-comment-btn",disabled:!s.user.id},{default:n(()=>[h(a(s.user.id?"发布评论":"请先登录"),1)]),_:1},8,["loading","disabled"])])]),t("div",Rs,[s.commentData.length>0?(c(),r("div",As,[(c(!0),r(p,null,v(s.commentData,(o,w)=>(c(),r("div",{key:w,class:"comment-item"},[t("div",zs,[t("img",{src:o.userAvatar||"https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",alt:o.userName,class:"comment-avatar"},null,8,Us),t("div",Bs,[t("span",Os,a(o.userName),1),t("span",qs,a(P(o.createTime)),1)]),o.userId===s.user.id?(c(),r("div",Js,[i(f,{type:"text",onClick:se=>R(o.id)},{default:n(()=>[i(m,null,{default:n(()=>[i(X)]),_:1}),e[30]||(e[30]=t("span",null,"删除",-1))]),_:2},1032,["onClick"])])):$("",!0)]),t("div",Ms,a(o.commentText),1),t("div",Ls,[i(f,{type:"text",class:"comment-like-btn"},{default:n(()=>[i(m,null,{default:n(()=>[i(Y)]),_:1}),e[31]||(e[31]=t("span",null,"有用",-1))]),_:1})])]))),128))])):(c(),r("div",js,"暂无评论，快来发表第一条评论吧！"))])])])]),i(F,{modelValue:s.formVisible,"onUpdate:modelValue":e[4]||(e[4]=o=>s.formVisible=o),title:"预告视频",width:"50%","destroy-on-close":"",class:"video-dialog"},{default:n(()=>[t("div",Hs,[t("h3",Ks,a(s.filmData.title)+" - 预告片",1),t("div",Xs,a(s.form.name),1),t("video",{src:s.form.video,controls:"",class:"video-player"},null,8,Ys)])]),_:1},8,["modelValue"]),i(F,{modelValue:s.scoreVisible,"onUpdate:modelValue":e[7]||(e[7]=o=>s.scoreVisible=o),title:"电影评分",width:"40%","destroy-on-close":"",class:"score-dialog"},{footer:n(()=>[t("span",Gs,[i(f,{onClick:e[6]||(e[6]=o=>s.scoreVisible=!1)},{default:n(()=>e[32]||(e[32]=[h("取 消")])),_:1}),i(f,{type:"primary",onClick:U},{default:n(()=>e[33]||(e[33]=[h("提 交")])),_:1})])]),default:n(()=>[i(Q,{ref:"form","label-width":"70px"},{default:n(()=>[i(G,{prop:"score",label:"电影评分"},{default:n(()=>[i(b,{modelValue:s.score,"onUpdate:modelValue":e[5]||(e[5]=o=>s.score=o),max:10,"show-score":"","text-color":"#ff9900","score-template":"{value} 分"},null,8,["modelValue"])]),_:1})]),_:1},512)]),_:1},8,["modelValue"])])}}},ue=W(Qs,[["__scopeId","data-v-07fe8908"]]);export{ue as default};
