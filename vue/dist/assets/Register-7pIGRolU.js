import{_ as Y,v as g,x as I,r as ee,c as x,a as i,b as l,w as o,F as A,aa as re,V as le,O as oe,o as _,h as f,u as d,aK as L,aN as se,aL as S,ay as B,az as P,j as M,ax as te,aO as ie,a2 as N,t as $,E as m,d as ae,aj as de,K as ne,T as ue,L as pe,m as fe,U as me,aM as ge}from"./index-DNfxLx3V.js";/* empty css               *//* empty css                *//* empty css                  *//* empty css             *//* empty css                 *//* empty css               *//* empty css              *//* empty css                    *//* empty css                     */import{r as k}from"./request-B9NmRS_H.js";import{B as ve}from"./BaiduMap-C0_a3k3m.js";const we={class:"register-wrapper"},Ve={class:"register-container"},Ee={class:"role-switch"},be={class:"register-actions"},xe={class:"map-container"},_e={key:0,class:"selected-location"},Ue={class:"dialog-footer"},ye={__name:"Register",setup(ce){const U="http://8.130.169.157",T=g([]),Z=g([]),j=g([]),p=g("USER"),v=g(!1),y=g(null),w=g(null);I(p,a=>{var e;r.form={role:a},(e=V.value)==null||e.clearValidate(),a==="USER"?(r.rules.email=[{validator:z,trigger:"blur"}],r.rules.phone=[{validator:F,trigger:"blur"}]):a==="CINEMA"&&(r.rules.email=[{required:!0,message:"请输入邮箱",trigger:"blur"},{validator:z,trigger:"blur"}],r.rules.phone=[{required:!0,message:"请输入联系电话",trigger:"blur"}],r.rules.address=[{required:!0,message:"请输入地址",trigger:"blur"}],r.rules.leader=[{required:!0,message:"请输入负责人姓名",trigger:"blur"}],r.rules.code=[{required:!0,message:"请输入身份证号",trigger:"blur"}],r.rules.front=[{required:!0,message:"请上传身份证正面照片",trigger:"change"}],r.rules.back=[{required:!0,message:"请上传身份证反面照片",trigger:"change"}],r.rules.certificate=[{required:!0,message:"请上传营业执照",trigger:"change"}])});const c=(a,e)=>{var s;a.code==="200"?(r.form[e]=a.data,(s=V.value)==null||s.validateField(e)):m.error("上传失败")},q=a=>{const e=a.type.startsWith("image/"),s=a.size/1024/1024<2;return e?s?!0:(m.error("文件大小不能超过 2MB!"),!1):(m.error("请上传图片格式文件!"),!1)},D=(a,e,s)=>{e?e!==r.form.password?s(new Error("确认密码跟原密码不一致!")):s():s(new Error("请确认密码"))},K=(a,e,s)=>{e?e.length<2?s(new Error("账号长度不能小于2位")):/^[a-zA-Z0-9_]+$/.test(e)?k.get("/user/checkUsername",{params:{username:e}}).then(E=>{E.code==="200"?E.data?s(new Error("该账号已被注册")):s():s(new Error("验证失败"))}).catch(()=>{s(new Error("验证失败"))}):s(new Error("账号只能包含字母、数字和下划线")):s(new Error("请输入账号"))},O=(a,e,s)=>{e?e.length<2?s(new Error("昵称长度不能小于2位")):s():s(new Error("请输入昵称"))},G=(a,e,s)=>{e?e.length<6?s(new Error("密码长度不能小于6位")):s():s(new Error("请输入密码"))},F=(a,e,s)=>{e?/^1[3-9]\d{9}$/.test(e)?s():s(new Error("请输入正确的手机号")):s(new Error("请输入手机号"))},z=(a,e,s)=>{e&&!/^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(e)?s(new Error("请输入正确的邮箱格式")):s()},r=ee({form:{role:p.value},rules:{username:[{validator:K,trigger:"blur"}],name:[{validator:O,trigger:"blur"}],password:[{validator:G,trigger:"blur"}],confirmPassword:[{validator:D,trigger:"blur"}],phone:[{validator:F,trigger:"blur"}],email:[{validator:z,trigger:"blur"}]}}),V=g(),W=()=>{V.value.validate(a=>{if(a){r.form.role=p.value;const e=[];if(r.form.username||e.push("账号"),r.form.name||e.push("昵称"),r.form.password||e.push("密码"),r.form.confirmPassword||e.push("确认密码"),r.form.phone||e.push("手机号/联系电话"),p.value==="CINEMA"&&(r.form.email||e.push("邮箱"),r.form.address||e.push("地址"),r.form.leader||e.push("负责人"),r.form.code||e.push("身份证号"),r.form.front||e.push("身份证正面照片"),r.form.back||e.push("身份证反面照片"),r.form.certificate||e.push("营业执照")),e.length>0){m({type:"warning",message:`请填写以下必填项: ${e.join("、")}`,duration:3e3});return}k.post("/register",r.form).then(s=>{s.code==="200"?(m({type:"success",message:p.value==="USER"?"注册成功，即将跳转到登录页面":"注册成功，请等待管理员审核后登录",duration:3e3}),setTimeout(()=>{ae.push("/login")},1500)):m({type:"error",message:s.msg||"注册失败",duration:3e3})}).catch(s=>{m({type:"error",message:"系统错误，请稍后重试",duration:3e3})})}else m({type:"warning",message:"请正确填写所有必填项",duration:3e3})})},h=a=>{w.value=a},H=()=>{w.value?(r.form.address=w.value.address,v.value=!1):m.warning("请先在地图上选择位置")};return I(v,a=>{a&&r.form.address&&y.value&&setTimeout(()=>{y.value.search(r.form.address)},500)}),(a,e)=>{const s=de,E=re,u=ne,n=ue,b=pe,R=fe,C=me,J=ge,Q=le,X=oe;return _(),x(A,null,[i("div",we,[i("div",Ve,[e[36]||(e[36]=i("div",{class:"register-header"},[i("h2",null,"欢 迎 注 册")],-1)),i("div",Ee,[l(E,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=t=>p.value=t),size:"large"},{default:o(()=>[l(s,{label:"USER"},{default:o(()=>e[16]||(e[16]=[f("用户注册")])),_:1}),l(s,{label:"CINEMA"},{default:o(()=>e[17]||(e[17]=[f("影院注册")])),_:1})]),_:1},8,["modelValue"])]),l(Q,{ref_key:"formRef",ref:V,model:r.form,rules:r.rules,"label-position":"top"},{default:o(()=>[l(n,{prop:"username",label:"账号"},{default:o(()=>[l(u,{"prefix-icon":d(L),size:"large",modelValue:r.form.username,"onUpdate:modelValue":e[1]||(e[1]=t=>r.form.username=t),placeholder:"请输入账号",maxlength:"20","show-word-limit":""},{prepend:o(()=>e[18]||(e[18]=[i("div",{class:"input-label required"},"账号",-1)])),_:1},8,["prefix-icon","modelValue"])]),_:1}),l(n,{prop:"name",label:"昵称"},{default:o(()=>[l(u,{"prefix-icon":d(se),size:"large",modelValue:r.form.name,"onUpdate:modelValue":e[2]||(e[2]=t=>r.form.name=t),placeholder:"请输入昵称",maxlength:"10","show-word-limit":""},{prepend:o(()=>e[19]||(e[19]=[i("div",{class:"input-label required"},"昵称",-1)])),_:1},8,["prefix-icon","modelValue"])]),_:1}),l(n,{prop:"password"},{default:o(()=>[l(u,{"show-password":"","prefix-icon":d(S),size:"large",modelValue:r.form.password,"onUpdate:modelValue":e[3]||(e[3]=t=>r.form.password=t),placeholder:"请输入密码",maxlength:"20","show-word-limit":""},{prepend:o(()=>e[20]||(e[20]=[i("div",{class:"input-label"},"密码",-1)])),_:1},8,["prefix-icon","modelValue"])]),_:1}),l(n,{prop:"confirmPassword"},{default:o(()=>[l(u,{"show-password":"","prefix-icon":d(S),size:"large",modelValue:r.form.confirmPassword,"onUpdate:modelValue":e[4]||(e[4]=t=>r.form.confirmPassword=t),placeholder:"请确认密码",maxlength:"20","show-word-limit":""},{prepend:o(()=>e[21]||(e[21]=[i("div",{class:"input-label"},"确认",-1)])),_:1},8,["prefix-icon","modelValue"])]),_:1}),p.value==="USER"?(_(),x(A,{key:0},[l(n,{prop:"phone"},{default:o(()=>[l(u,{"prefix-icon":d(B),size:"large",modelValue:r.form.phone,"onUpdate:modelValue":e[5]||(e[5]=t=>r.form.phone=t),placeholder:"请输入手机号",maxlength:"11"},{prepend:o(()=>e[22]||(e[22]=[i("div",{class:"input-label required"},"手机",-1)])),_:1},8,["prefix-icon","modelValue"])]),_:1}),l(n,{prop:"email"},{default:o(()=>[l(u,{"prefix-icon":d(P),size:"large",modelValue:r.form.email,"onUpdate:modelValue":e[6]||(e[6]=t=>r.form.email=t),placeholder:"请输入邮箱（选填）"},{prepend:o(()=>e[23]||(e[23]=[i("div",{class:"input-label"},"邮箱",-1)])),_:1},8,["prefix-icon","modelValue"])]),_:1})],64)):M("",!0),p.value==="CINEMA"?(_(),x(A,{key:1},[l(n,{prop:"phone"},{default:o(()=>[l(u,{"prefix-icon":d(B),size:"large",modelValue:r.form.phone,"onUpdate:modelValue":e[7]||(e[7]=t=>r.form.phone=t),placeholder:"请输入联系电话",maxlength:"11"},{prepend:o(()=>e[24]||(e[24]=[i("div",{class:"input-label required"},"电话",-1)])),_:1},8,["prefix-icon","modelValue"])]),_:1}),l(n,{prop:"email"},{default:o(()=>[l(u,{"prefix-icon":d(P),size:"large",modelValue:r.form.email,"onUpdate:modelValue":e[8]||(e[8]=t=>r.form.email=t),placeholder:"请输入邮箱"},{prepend:o(()=>e[25]||(e[25]=[i("div",{class:"input-label required"},"邮箱",-1)])),_:1},8,["prefix-icon","modelValue"])]),_:1}),l(n,{prop:"address"},{default:o(()=>[l(u,{"prefix-icon":d(te),size:"large",modelValue:r.form.address,"onUpdate:modelValue":e[10]||(e[10]=t=>r.form.address=t),placeholder:"请输入地址"},{prepend:o(()=>e[26]||(e[26]=[i("div",{class:"input-label required"},"地址",-1)])),append:o(()=>[l(b,{onClick:e[9]||(e[9]=t=>v.value=!0)},{default:o(()=>e[27]||(e[27]=[f("地图选择")])),_:1})]),_:1},8,["prefix-icon","modelValue"])]),_:1}),l(n,{prop:"leader"},{default:o(()=>[l(u,{"prefix-icon":d(L),size:"large",modelValue:r.form.leader,"onUpdate:modelValue":e[11]||(e[11]=t=>r.form.leader=t),placeholder:"请输入负责人姓名"},{prepend:o(()=>e[28]||(e[28]=[i("div",{class:"input-label required"},"负责人",-1)])),_:1},8,["prefix-icon","modelValue"])]),_:1}),e[33]||(e[33]=i("div",{class:"sub-title"},"影院认证资料（提交后审核）",-1)),l(n,{prop:"code"},{default:o(()=>[l(u,{"prefix-icon":d(ie),size:"large",modelValue:r.form.code,"onUpdate:modelValue":e[12]||(e[12]=t=>r.form.code=t),placeholder:"请输入负责人身份证号"},{prepend:o(()=>e[29]||(e[29]=[i("div",{class:"input-label required"},"证件号",-1)])),_:1},8,["prefix-icon","modelValue"])]),_:1}),l(n,{prop:"front"},{default:o(()=>[e[30]||(e[30]=i("p",{class:"field-label required"},"上传身份证正面照片",-1)),l(C,{action:d(U)+"/files/upload","on-success":t=>c(t,"front"),"before-upload":q,"list-type":"picture-card",limit:1,"file-list":T.value},{default:o(()=>[l(R,null,{default:o(()=>[l(d(N))]),_:1})]),_:1},8,["action","on-success","file-list"])]),_:1}),l(n,{prop:"back"},{default:o(()=>[e[31]||(e[31]=i("p",{class:"field-label required"},"上传身份证反面照片",-1)),l(C,{action:d(U)+"/files/upload","on-success":t=>c(t,"back"),"before-upload":q,"list-type":"picture-card",limit:1,"file-list":Z.value},{default:o(()=>[l(R,null,{default:o(()=>[l(d(N))]),_:1})]),_:1},8,["action","on-success","file-list"])]),_:1}),l(n,{prop:"certificate"},{default:o(()=>[e[32]||(e[32]=i("p",{class:"field-label required"},"上传营业执照",-1)),l(C,{action:d(U)+"/files/upload","on-success":t=>c(t,"certificate"),"before-upload":q,"list-type":"picture-card",limit:1,"file-list":j.value},{default:o(()=>[l(R,null,{default:o(()=>[l(d(N))]),_:1})]),_:1},8,["action","on-success","file-list"])]),_:1})],64)):M("",!0),l(n,null,{default:o(()=>[l(b,{size:"large",type:"primary",class:"register-btn",onClick:W},{default:o(()=>e[34]||(e[34]=[f("注 册")])),_:1})]),_:1}),i("div",be,[l(J,{type:"primary",onClick:e[13]||(e[13]=t=>a.$router.push("/login"))},{default:o(()=>e[35]||(e[35]=[f("已有账号？请登录")])),_:1})])]),_:1},8,["model","rules"])])]),l(X,{modelValue:v.value,"onUpdate:modelValue":e[15]||(e[15]=t=>v.value=t),title:"选择影院位置",width:"800px","destroy-on-close":""},{footer:o(()=>[i("span",Ue,[l(b,{onClick:e[14]||(e[14]=t=>v.value=!1)},{default:o(()=>e[40]||(e[40]=[f("取消")])),_:1}),l(b,{type:"primary",onClick:H},{default:o(()=>e[41]||(e[41]=[f("确认选择")])),_:1})])]),default:o(()=>[i("div",xe,[e[37]||(e[37]=i("p",{class:"map-tip"},"请在地图上搜索或点击选择您影院的准确位置",-1)),l(ve,{ref_key:"mapRef",ref:y,height:500,selectable:!0,onSelectAddress:h},null,512)]),w.value?(_(),x("div",_e,[i("p",null,[e[38]||(e[38]=i("strong",null,"已选位置：",-1)),f($(w.value.title),1)]),i("p",null,[e[39]||(e[39]=i("strong",null,"详细地址：",-1)),f($(w.value.address),1)])])):M("",!0)]),_:1},8,["modelValue"])],64)}}},Pe=Y(ye,[["__scopeId","data-v-b9413a4a"]]);export{Pe as default};
