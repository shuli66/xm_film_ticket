import{r as M,c as b,a as v,b as t,w as a,j as n,E as w,J as k,K as T,B as O,L as A,M as J,N as U,o as s,h as r,i as u,t as i,F,z as P,u as $,Q as j,I as q,R as G,ad as K,S as Q,G as R,af as H}from"./index-CwlnEuFy.js";/* empty css                   *//* empty css            *//* empty css               *//* empty css                  *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                *//* empty css                          *//* empty css                     *//* empty css               *//* empty css              */import{r as N}from"./request--KQcSzqU.js";/* empty css                    *//* empty css                */const W={class:"card",style:{"margin-bottom":"5px"}},X={key:0,class:"card",style:{"margin-bottom":"5px"}},Y={class:"card",style:{"margin-bottom":"5px"}},Z={key:0},ee={key:1,class:"card"},ye={__name:"Orders",setup(te){const l=M({user:JSON.parse(localStorage.getItem("xm-user")||"{}"),orderNo:null,cinemaName:null,status:null,tableData:[],pageNum:1,pageSize:5,total:0,ids:[],form:{}}),_=()=>{N.get("/orders/selectPage",{params:{pageNum:l.pageNum,pageSize:l.pageSize,orderNo:l.orderNo,cinemaName:l.cinemaName,status:l.status}}).then(d=>{d.code==="200"?(l.tableData=d.data.list,l.total=d.data.total):w.error(d.msg)})},I=d=>{k.confirm("您确定该订单已经取票了吗?","取票确认",{type:"warning"}).then(o=>{l.form=JSON.parse(JSON.stringify(d)),l.form.status="已取票",N.put("/orders/update",l.form).then(f=>{f.code==="200"?(w.success("操作成功"),_()):w.error(f.msg)})}).catch(o=>{console.error(o)})},S=d=>{k.confirm("删除后数据无法恢复，您确定删除吗？","删除确认",{type:"warning"}).then(o=>{N.delete("/orders/delete/"+d).then(f=>{f.code==="200"?(w.success("删除成功"),_()):w.error(f.msg)})}).catch(o=>{console.error(o)})},E=()=>{if(!l.ids.length){w.warning("请选择数据");return}k.confirm("删除后数据无法恢复，您确定删除吗？","删除确认",{type:"warning"}).then(d=>{N.delete("/orders/delete/batch",{data:l.ids}).then(o=>{o.code==="200"?(w.success("操作成功"),_()):w.error(o.msg)})}).catch(d=>{console.error(d)})},C=d=>{l.ids=d.map(o=>o.id)},V=()=>{l.orderNo=null,l.cinemaName=null,l.status=null,_()};return _(),(d,o)=>{const f=T,h=q,D=O,y=A,m=G,c=K,x=Q,g=R,B=H,z=J,L=U;return s(),b("div",null,[v("div",W,[t(f,{modelValue:l.orderNo,"onUpdate:modelValue":o[0]||(o[0]=e=>l.orderNo=e),"prefix-icon":"Search",style:{width:"240px","margin-right":"10px"},placeholder:"请输入订单编号查询"},null,8,["modelValue"]),t(f,{modelValue:l.cinemaName,"onUpdate:modelValue":o[1]||(o[1]=e=>l.cinemaName=e),"prefix-icon":"Search",style:{width:"240px","margin-right":"10px"},placeholder:"请输入电影院名称查询"},null,8,["modelValue"]),t(D,{modelValue:l.status,"onUpdate:modelValue":o[2]||(o[2]=e=>l.status=e),placeholder:"请选择订单状态",style:{width:"240px","margin-right":"10px"}},{default:a(()=>[t(h,{label:"待取票",value:"待取票"}),t(h,{label:"已取票",value:"已取票"}),t(h,{label:"已退票",value:"已退票"}),t(h,{label:"待支付",value:"待支付"})]),_:1},8,["modelValue"]),t(y,{type:"info",plain:"",onClick:_},{default:a(()=>o[4]||(o[4]=[r("查询")])),_:1}),t(y,{type:"warning",plain:"",style:{margin:"0 10px"},onClick:V},{default:a(()=>o[5]||(o[5]=[r("重置")])),_:1})]),l.user.role==="ADMIN"?(s(),b("div",X,[t(y,{type:"danger",plain:"",onClick:E},{default:a(()=>o[6]||(o[6]=[r("批量删除")])),_:1})])):n("",!0),v("div",Y,[t(z,{"tooltip-effect":"dark widthStyle",stripe:"",data:l.tableData,onSelectionChange:C},{default:a(()=>[l.user.role==="ADMIN"?(s(),u(m,{key:0,type:"selection",width:"55"})):n("",!0),t(m,{type:"expand"},{default:a(e=>[t(B,{class:"margin-top",title:"购票信息",column:4,border:""},{default:a(()=>[t(c,{label:"订单号"},{default:a(()=>[r(i(e.row.orderNo),1)]),_:2},1024),t(c,{label:"用户姓名"},{default:a(()=>[r(i(e.row.userName),1)]),_:2},1024),t(c,{label:"电影名称"},{default:a(()=>[r(i(e.row.filmName),1)]),_:2},1024),t(c,{label:"电影图片"},{default:a(()=>[e.row.filmImg?(s(),u(x,{key:0,style:{width:"40px",height:"40px",display:"block"},src:e.row.filmImg,"preview-src-list":[e.row.filmImg],"preview-teleported":""},null,8,["src","preview-src-list"])):n("",!0)]),_:2},1024),t(c,{label:"影院名称"},{default:a(()=>[r(i(e.row.cinemaName),1)]),_:2},1024),t(c,{label:"座位号"},{default:a(()=>[e.row.seatList&&e.row.seatList.length>0?(s(),b("div",Z,[(s(!0),b(F,null,P(e.row.seatList,p=>(s(),u(g,{type:"danger",style:{"margin-right":"5px"}},{default:a(()=>[r(i(p.row+"排"+p.col+"座"),1)]),_:2},1024))),256))])):n("",!0)]),_:2},1024),t(c,{label:"放映时间"},{default:a(()=>[r(i(e.row.time),1)]),_:2},1024),t(c,{label:"购票数量"},{default:a(()=>{var p;return[r(i((p=e.row.seatList)==null?void 0:p.length),1)]}),_:2},1024),t(c,{label:"订单金额"},{default:a(()=>[r(i(e.row.price),1)]),_:2},1024),t(c,{label:"下单时间"},{default:a(()=>[r(i(e.row.createTime),1)]),_:2},1024),t(c,{label:"订单状态"},{default:a(()=>[e.row.status==="待取票"?(s(),u(g,{key:0,type:"warning"},{default:a(()=>[r(i(e.row.status),1)]),_:2},1024)):n("",!0),e.row.status==="已取票"?(s(),u(g,{key:1,type:"success"},{default:a(()=>[r(i(e.row.status),1)]),_:2},1024)):n("",!0),e.row.status==="已退票"?(s(),u(g,{key:2,type:"danger"},{default:a(()=>[r(i(e.row.status),1)]),_:2},1024)):n("",!0),e.row.status==="待支付"?(s(),u(g,{key:3,type:"primary"},{default:a(()=>[r(i(e.row.status),1)]),_:2},1024)):n("",!0)]),_:2},1024)]),_:2},1024)]),_:1}),t(m,{prop:"orderNo",label:"订单号","show-overflow-tooltip":""}),t(m,{prop:"userName",label:"用户姓名",width:"90"}),t(m,{prop:"filmName",label:"电影名称","show-overflow-tooltip":""}),t(m,{prop:"filmImg",label:"电影封面",width:"90"},{default:a(e=>[e.row.filmImg?(s(),u(x,{key:0,style:{width:"40px",height:"40px","border-radius":"5px",display:"block"},src:e.row.filmImg,"preview-src-list":[e.row.filmImg],"preview-teleported":""},null,8,["src","preview-src-list"])):n("",!0)]),_:1}),l.user.role==="ADMIN"?(s(),u(m,{key:1,prop:"cinemaName",label:"影院名称","show-overflow-tooltip":""})):n("",!0),t(m,{prop:"roomName",label:"影厅名称"}),t(m,{prop:"time",label:"放映时间","show-overflow-tooltip":""}),t(m,{prop:"num",label:"购票数量"},{default:a(e=>{var p;return[r(i((p=e.row.seatList)==null?void 0:p.length),1)]}),_:1}),t(m,{prop:"price",label:"订单金额"},{default:a(e=>[r(i(e.row.price.toFixed(2)),1)]),_:1}),t(m,{prop:"status",label:"订单状态"},{default:a(e=>[e.row.status==="待取票"?(s(),u(g,{key:0,type:"warning"},{default:a(()=>[r(i(e.row.status),1)]),_:2},1024)):n("",!0),e.row.status==="已取票"?(s(),u(g,{key:1,type:"success"},{default:a(()=>[r(i(e.row.status),1)]),_:2},1024)):n("",!0),e.row.status==="已退票"?(s(),u(g,{key:2,type:"danger"},{default:a(()=>[r(i(e.row.status),1)]),_:2},1024)):n("",!0),e.row.status==="待支付"?(s(),u(g,{key:3,type:"primary"},{default:a(()=>[r(i(e.row.status),1)]),_:2},1024)):n("",!0)]),_:1}),t(m,{label:"操作",width:"100",fixed:"right"},{default:a(e=>[l.user.role==="ADMIN"?(s(),u(y,{key:0,type:"danger",circle:"",icon:$(j),onClick:p=>S(e.row.id)},null,8,["icon","onClick"])):(s(),u(y,{key:1,type:"primary",disabled:e.row.status!=="待取票",onClick:p=>I(e.row)},{default:a(()=>o[7]||(o[7]=[r("已取票")])),_:2},1032,["disabled","onClick"]))]),_:1})]),_:1},8,["data"])]),l.total?(s(),b("div",ee,[t(L,{onCurrentChange:_,background:"",layout:"prev, pager, next","page-size":l.pageSize,"current-page":l.pageNum,"onUpdate:currentPage":o[3]||(o[3]=e=>l.pageNum=e),total:l.total},null,8,["page-size","current-page","total"])])):n("",!0)])}}};export{ye as default};
