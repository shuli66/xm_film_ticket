import{_ as $,r as S,v as P,av as q,y as R,c as l,a,b as s,w as o,t as c,h as m,F as I,z as y,j as T,ap as A,E as p,m as V,G,L as j,M as U,N as W,o as r,u as f,aw as H,ax as F,ay as J,az as K,aA as O,C as Q,aB as X,R as Y,a8 as Z}from"./index-CwlnEuFy.js";/* empty css              *//* empty css                   *//* empty css            *//* empty css               *//* empty css                  *//* empty css               *//* empty css                     *//* empty css                 *//* empty css                *//* empty css               */import{r as k}from"./request--KQcSzqU.js";import{B as ee}from"./BaiduMap-Dyls06sG.js";/* empty css              */const te={class:"cinema-detail-container"},ae={class:"cinema-info-card"},se={class:"cinema-header"},ne=["src"],ie={key:1,class:"cinema-avatar cinema-avatar-placeholder"},oe={class:"cinema-basic-info"},le={class:"cinema-name"},re={class:"cinema-address"},ce={class:"cinema-contact"},de={class:"contact-item"},me={class:"contact-item"},ue={class:"cinema-services"},pe={class:"cinema-map-section"},fe={class:"cinema-map"},_e={class:"cinema-location-info"},ge={class:"cinema-films-section"},he={class:"films-grid"},ve=["onClick"],Ie={class:"film-poster"},ye=["src","alt"],ke={class:"film-info"},we={class:"film-title"},Fe={class:"film-score"},Ce={key:0,class:"showtimes-section"},be={class:"film-header"},Me={class:"section-title"},Ne={class:"film-meta"},Be={class:"film-score"},Ee={class:"film-details"},ze={key:0},xe={key:1},De={class:"showtimes-table"},Le={class:"price"},$e={key:0,class:"pagination-container"},Se={key:1,class:"empty-state"},Pe={__name:"CinemaDetail",setup(qe){const _=A(),C=X(),e=S({cinemaInfo:{},filmList:[],mapMarker:null,currentFilm:{},showData:[],pageNum:1,pageSize:5,total:0,filmId:_.query.filmId}),v=P(null);q(()=>e.cinemaInfo.longitude&&e.cinemaInfo.latitude?{lng:e.cinemaInfo.longitude,lat:e.cinemaInfo.latitude,title:e.cinemaInfo.name}:null);const b=()=>{const i=_.query.id;if(!i){p.error("影院ID不能为空"),C.push("/front/films");return}k.get(`/cinema/selectById/${i}`).then(t=>{t.code==="200"?(e.cinemaInfo=t.data,e.cinemaInfo.address&&(e.mapMarker={lng:116.404,lat:39.915,title:e.cinemaInfo.name},setTimeout(()=>{M(e.cinemaInfo.address,e.cinemaInfo.name)},1e3))):p.error(t.msg||"获取影院信息失败")}).catch(()=>{p.error("系统错误，请稍后重试")})},M=(i,t)=>{if(!window.BMap){console.error("百度地图API尚未加载");return}new BMap.Geocoder().getPoint(i,function(d){d&&(e.mapMarker={lng:d.lng,lat:d.lat,title:t},v.value&&v.value.setCenter(d.lng,d.lat))},"全国")},N=()=>{const i=_.query.id;i&&k.get(`/show/selectByCinemaId/${i}`).then(t=>{if(t.code==="200")if(e.filmList=t.data||[],e.filmId){const u=e.filmList.find(d=>d.id==e.filmId);u&&(e.currentFilm=u,g())}else e.filmList.length>0&&(e.currentFilm=e.filmList[0],g());else p.error(t.msg||"获取电影列表失败")}).catch(()=>{p.error("系统错误，请稍后重试")})},B=i=>{e.currentFilm=i,g()},g=()=>{const i=_.query.id;!i||!e.currentFilm.id||k.get("/show/selectPage",{params:{pageNum:e.pageNum,pageSize:e.pageSize,filmId:e.currentFilm.id,cinemaId:i,status:"购票中"}}).then(t=>{t.code==="200"?(e.showData=t.data.list,e.total=t.data.total):p.error(t.msg||"获取放映场次失败")}).catch(()=>{p.error("系统错误，请稍后重试")})},E=()=>{if(!e.mapMarker){p.warning("正在获取位置信息，请稍后再试");return}const i=`https://api.map.baidu.com/direction?destination=latlng:${e.mapMarker.lat},${e.mapMarker.lng}|name:${e.cinemaInfo.name}&mode=driving&region=北京&output=html&src=webapp.baidu.openAPIdemo`;window.open(i,"_blank")};return R(()=>{b(),N()}),(i,t)=>{const u=V,d=G,w=j,h=Y,z=U,x=W,D=Z;return r(),l("div",te,[a("div",ae,[a("div",se,[e.cinemaInfo.avatar?(r(),l("img",{key:0,src:e.cinemaInfo.avatar,alt:"影院logo",class:"cinema-avatar"},null,8,ne)):(r(),l("div",ie,[s(u,null,{default:o(()=>[s(f(H))]),_:1})])),a("div",oe,[a("h1",le,c(e.cinemaInfo.name),1),a("div",re,[s(u,null,{default:o(()=>[s(f(F))]),_:1}),a("span",null,c(e.cinemaInfo.address),1)]),a("div",ce,[a("span",de,[s(u,null,{default:o(()=>[s(f(J))]),_:1}),a("span",null,c(e.cinemaInfo.phone||"暂无联系电话"),1)]),a("span",me,[s(u,null,{default:o(()=>[s(f(K))]),_:1}),a("span",null,c(e.cinemaInfo.email||"暂无电子邮箱"),1)])]),a("div",ue,[s(d,{type:"danger"},{default:o(()=>t[1]||(t[1]=[m("退票无忧")])),_:1}),s(d,{type:"success"},{default:o(()=>t[2]||(t[2]=[m("儿童优惠")])),_:1}),s(d,{type:"primary"},{default:o(()=>t[3]||(t[3]=[m("WiFi覆盖")])),_:1}),s(d,{type:"info"},{default:o(()=>t[4]||(t[4]=[m("免费停车")])),_:1})])])]),a("div",pe,[t[6]||(t[6]=a("h2",{class:"section-title"},"影院位置",-1)),a("div",fe,[s(ee,{ref_key:"mapRef",ref:v,height:400,showSearch:!1,selectable:!1,defaultMarker:e.mapMarker},null,8,["defaultMarker"])]),a("div",_e,[a("p",null,[s(u,null,{default:o(()=>[s(f(F))]),_:1}),a("span",null,c(e.cinemaInfo.address),1)]),s(w,{type:"primary",onClick:E},{default:o(()=>[s(u,null,{default:o(()=>[s(f(O))]),_:1}),t[5]||(t[5]=m(" 导航到这里 "))]),_:1})])]),a("div",ge,[t[8]||(t[8]=a("h2",{class:"section-title"},[m("该影院上线电影 "),a("span",{class:"subtitle"},"(点击选择电影)")],-1)),a("div",he,[(r(!0),l(I,null,y(e.filmList,n=>(r(),l("div",{key:n.id,class:Q(["film-card",{active:n.id===e.currentFilm.id}]),onClick:L=>B(n)},[a("div",Ie,[a("img",{src:n.img,alt:n.title},null,8,ye)]),a("div",ke,[a("div",we,c(n.title),1),a("div",Fe,[m(c(n.score)+" ",1),t[7]||(t[7]=a("span",null,"分",-1))])])],10,ve))),128))])]),e.currentFilm.title?(r(),l("div",Ce,[a("div",be,[a("h2",Me,c(e.currentFilm.title),1),a("div",Ne,[a("span",Be,[m(c(e.currentFilm.score)+" ",1),t[9]||(t[9]=a("span",null,"分",-1))]),a("div",Ee,[a("span",null,"时长："+c(e.currentFilm.time)+" 分钟",1),t[12]||(t[12]=a("span",{class:"separator"},"|",-1)),a("span",null,[t[10]||(t[10]=m("类型：")),(r(!0),l(I,null,y(e.currentFilm.types,n=>(r(),l("span",{key:n,class:"film-type"},c(n),1))),128))]),t[13]||(t[13]=a("span",{class:"separator"},"|",-1)),a("span",null,[t[11]||(t[11]=m("演员： ")),e.currentFilm.actors&&e.currentFilm.actors.length?(r(),l("span",ze,[(r(!0),l(I,null,y(e.currentFilm.actors,n=>(r(),l("span",{key:n,class:"film-actor"},c(n),1))),128))])):(r(),l("span",xe,"管理员暂未录入演职人员"))])])])]),a("div",De,[s(z,{stripe:"",data:e.showData},{default:o(()=>[s(h,{prop:"time",label:"放映时间"}),s(h,{prop:"roomName",label:"放映厅"}),s(h,{prop:"price",label:"售价"},{default:o(n=>[a("span",Le,"¥"+c(n.row.price.toFixed(2)),1)]),_:1}),s(h,{label:"操作",width:"150",fixed:"right"},{default:o(n=>[s(w,{type:"danger",onClick:L=>i.$router.push("/front/seat?id="+n.row.id)},{default:o(()=>t[14]||(t[14]=[m(" 选座购票 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),e.total>0?(r(),l("div",$e,[s(x,{onCurrentChange:g,background:"",layout:"total, prev, pager, next","page-size":e.pageSize,"current-page":e.pageNum,"onUpdate:currentPage":t[0]||(t[0]=n=>e.pageNum=n),total:e.total},null,8,["page-size","current-page","total"])])):T("",!0)])])):(r(),l("div",Se,[s(D,{description:"请选择一部电影查看放映场次"})]))])])}}},Ye=$(Pe,[["__scopeId","data-v-45a730e9"]]);export{Ye as default};
