import{r as E,d as h,c as y,a as e,b as r,F as c,z as u,t as n,h as a,w as f,E as g,J as k,L as B,X as N,o as m,i as A,a7 as C}from"./index-CwlnEuFy.js";/* empty css            *//* empty css               */import{r as _}from"./request--KQcSzqU.js";/* empty css                    *//* empty css              *//* empty css                */const L={style:{width:"50%",margin:"40px auto",border:"1px solid #eeeeee",padding:"20px"}},q={style:{"margin-top":"50px",display:"flex"}},F={style:{flex:"3"}},R={style:{display:"flex","text-align":"center"}},V={style:{flex:"1"}},J={style:{flex:"1"}},M={style:{flex:"1"}},T={style:{"text-align":"center",padding:"40px 60px"}},O={style:{flex:"2","background-color":"#fdfcfc",padding:"20px"}},X={style:{display:"flex"}},$=["src"],j={style:{flex:"1","margin-left":"10px"}},G={style:{"font-size":"20px","font-weight":"bold"}},H={style:{"margin-top":"10px"}},K={style:{"margin-right":"5px"}},P={style:{"margin-top":"10px"}},Q={style:{"margin-top":"20px","font-size":"15px"}},U={style:{"margin-top":"10px","font-size":"15px"}},W={style:{"margin-top":"10px","font-size":"15px"}},Y={style:{"margin-top":"10px","font-size":"15px"}},Z={style:{"margin-top":"10px","font-size":"15px"}},tt={style:{color:"red"}},et={style:{"margin-top":"10px","font-size":"15px",display:"flex","align-items":"center"}},st={style:{flex:"1"}},ot={style:{"margin-top":"20px","font-size":"15px"}},lt={style:{color:"#666666"}},it={style:{color:"red"}},nt={style:{"font-size":"25px"}},rt={style:{"text-align":"center","margin-top":"50px"}},ut={__name:"Seat",setup(at){const s=E({user:JSON.parse(localStorage.getItem("xm-user")||"{}"),showId:h.currentRoute.value.query.id,showData:{},film:{},total:0,alreadySaleSeats:[],selectedSeats:[]}),S=(o,t)=>{let l=s.alreadySaleSeats.filter(i=>i.row===o&&i.col===t);return l&&l.length>0},v=(o,t)=>{let l=s.alreadySaleSeats.filter(d=>d.row===o&&d.col===t);if(l&&l.length>0)return"danger";let i=s.selectedSeats.filter(d=>d.row===o&&d.col===t);return i&&i.length>0?"warning":"success"},I=(o,t)=>{if(!s.selectedSeats.length)w(o,t);else{let l=s.selectedSeats.filter(i=>i.row===o&&i.col===t);l&&l.length>0?s.selectedSeats=s.selectedSeats.filter(i=>!(i.row===o&&i.col===t)):w(o,t)}s.total=s.showData.price*s.selectedSeats.length},w=(o,t)=>{let l={row:o,col:t};if(s.selectedSeats.length>=4){g.info("最多只能选择4个座位");return}s.selectedSeats.push(l)},D=()=>{s.showId=h.currentRoute.value.query.id,_.get("/show/selectById/"+s.showId).then(o=>{o.code==="200"?(s.showData=o.data,s.film=o.data.film,z()):g.error(o.msg)})},b=()=>{if(s.selectedSeats.length===0){g.error("请至少选择一张座位");return}k.confirm("您确定选择这些座位并且下单购买吗？","购票确认",{type:"warning"}).then(o=>{let t={filmId:s.film.id,time:s.showData.time,cinemaId:s.showData.cinemaId,roomId:s.showData.roomId,seatList:s.selectedSeats,showId:s.showId};_.post("/orders/add",t).then(l=>{l.code==="200"?(g.success("创建订单成功！"),h.push("/front/orders")):g.error(l.msg)})}).catch(o=>{console.error(o)})},z=()=>{_.get("/orders/selectAll",{params:{filmId:s.film.id,cinemaId:s.showData.cinemaId,roomId:s.showData.roomId}}).then(o=>{o.code==="200"?o.data.filter(l=>l.status!=="已退票").forEach(l=>{l.seatList.forEach(i=>{s.alreadySaleSeats.push(i)})}):g.error(o.msg)})};return D(),(o,t)=>{const l=B,i=C,d=N;return m(),y("div",L,[t[15]||(t[15]=e("div",{style:{"font-weight":"bold","font-size":"26px","text-align":"center"}},"座位选择",-1)),e("div",q,[e("div",F,[e("div",R,[e("div",V,[r(l,{type:"danger"}),t[0]||(t[0]=e("span",{style:{"margin-left":"5px"}},"已售座位",-1))]),e("div",J,[r(l,{type:"success"}),t[1]||(t[1]=e("span",{style:{"margin-left":"5px"}},"可选座位",-1))]),e("div",M,[r(l,{type:"warning"}),t[2]||(t[2]=e("span",{style:{"margin-left":"5px"}},"已选座位",-1))])]),t[3]||(t[3]=e("div",{style:{height:"5px","background-color":"#d9d9d9",margin:"30px 40px"}},null,-1)),t[4]||(t[4]=e("div",{style:{"text-align":"center"}},"荧幕中央",-1)),e("div",T,[(m(),y(c,null,u(8,p=>r(d,{gutter:5,style:{"margin-bottom":"12px"}},{default:f(()=>[(m(),y(c,null,u(8,x=>r(i,{span:3},{default:f(()=>[r(l,{style:{height:"30px",width:"30px"},type:v(p,x),onClick:dt=>I(p,x),disabled:S(p,x)},{default:f(()=>[a(n(x),1)]),_:2},1032,["type","onClick","disabled"])]),_:2},1024)),64))]),_:2},1024)),64))])]),e("div",O,[e("div",X,[e("img",{src:s.film.img,alt:"",style:{width:"100px",height:"120px"}},null,8,$),e("div",j,[e("div",G,n(s.film.title),1),e("div",H,[t[5]||(t[5]=e("span",{style:{color:"#666666"}},"类型：",-1)),(m(!0),y(c,null,u(s.film.types,p=>(m(),y("span",K,n(p),1))),256))]),e("div",P,"时长："+n(s.film.time)+"分钟",1)])]),e("div",Q,[t[6]||(t[6]=e("span",{style:{color:"#666666"}},"影院：",-1)),a(n(s.showData.cinemaName),1)]),e("div",U,[t[7]||(t[7]=e("span",{style:{color:"#666666"}},"影厅：",-1)),a(n(s.showData.roomName),1)]),e("div",W,[t[8]||(t[8]=e("span",{style:{color:"#666666"}},"语言：",-1)),a(n(s.film.language),1)]),e("div",Y,[t[9]||(t[9]=e("span",{style:{color:"#666666"}},"场次：",-1)),a(n(s.showData.time),1)]),e("div",Z,[t[10]||(t[10]=e("span",{style:{color:"#666666"}},"票价：",-1)),e("span",tt,"￥ "+n(s.showData.price)+"/张",1)]),e("div",et,[t[11]||(t[11]=e("div",{style:{color:"#666666",width:"50px"}},"座位：",-1)),e("div",st,[r(d,{gutter:10},{default:f(()=>[(m(!0),y(c,null,u(s.selectedSeats,p=>(m(),A(i,{span:6},{default:f(()=>[r(l,{type:"info",style:{width:"60px",height:"30px"}},{default:f(()=>[a(n(p.row+"排"+p.col+"座"),1)]),_:2},1024)]),_:2},1024))),256))]),_:1})])]),e("div",ot,[e("span",lt,[t[13]||(t[13]=a("费用： ")),e("span",it,[t[12]||(t[12]=a("￥")),e("span",nt,n(s.total.toFixed(2)),1)])])]),e("div",rt,[r(l,{style:{padding:"20px 100px","border-radius":"20px"},type:"danger",onClick:b},{default:f(()=>t[14]||(t[14]=[a("确认选座")])),_:1})])])])])}}};export{ut as default};
